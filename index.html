<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒ∞stegelsin - Alƒ±≈üveri≈ü ve ƒ∞lan Platformu</title>
    <!-- Supabase k√ºt√ºphanesi -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Font Awesome Icons (isteƒüe baƒülƒ±, g√∂rselliƒüi artƒ±rƒ±r) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* ========== GENEL STƒ∞LLER ========== */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: #f5f5f5; color: #333; }
        /* ========== TOPBAR ========== */
        .topbar { background-color: #2c3e50; color: white; padding: 12px 30px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .logo { font-size: 28px; font-weight: bold; cursor: pointer; letter-spacing: 1px; color: #ecf0f1; }
        .logo span { color: #e67e22; }
        .search-box { flex-grow: 1; max-width: 600px; margin: 0 30px; display: flex; }
        .search-box input { width: 100%; padding: 12px 20px; border: none; border-radius: 30px 0 0 30px; font-size: 16px; outline: none; }
        .search-box button { background-color: #e67e22; border: none; color: white; padding: 12px 25px; border-radius: 0 30px 30px 0; cursor: pointer; font-size: 16px; transition: background 0.3s; }
        .search-box button:hover { background-color: #d35400; }
        .auth-buttons { display: flex; gap: 15px; align-items: center; }
        .auth-buttons button { background-color: transparent; border: 1px solid #ecf0f1; color: white; padding: 8px 20px; border-radius: 20px; cursor: pointer; font-size: 14px; transition: all 0.3s; }
        .auth-buttons button:hover { background-color: #e67e22; border-color: #e67e22; }
        .user-info { display: flex; align-items: center; gap: 10px; }
        .user-info span { font-size: 14px; }
        .user-info button { background-color: #e67e22; border: none; padding: 5px 15px; border-radius: 15px; }
        /* ========== ANA ƒ∞√áERƒ∞K ========== */
        .main-container { display: flex; max-width: 1400px; margin: 20px auto; padding: 0 20px; gap: 25px; align-items: flex-start; }
        /* ========== SOL KATEGORƒ∞ MEN√úS√ú ========== */
        .categories-sidebar { width: 280px; background: white; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); padding: 20px 0; position: sticky; top: 90px; max-height: calc(100vh - 110px); overflow-y: auto; }
        .categories-sidebar h3 { padding: 0 20px 15px 20px; font-size: 18px; color: #2c3e50; border-bottom: 2px solid #f0f0f0; margin-bottom: 15px; }
        .category-main { margin-bottom: 5px; }
        .category-header { padding: 12px 20px; font-weight: 600; color: #34495e; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: background 0.2s; border-left: 4px solid transparent; }
        .category-header:hover { background-color: #f8f9fa; border-left-color: #e67e22; }
        .category-header i { transition: transform 0.3s; color: #95a5a6; }
        .subcategory-list { list-style: none; background-color: #fafafa; max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; padding: 0 20px 0 40px; }
        .subcategory-list.show { max-height: 500px; padding-bottom: 10px; }
        .subcategory-list li { padding: 8px 0; font-size: 14px; color: #555; cursor: pointer; transition: color 0.2s; }
        .subcategory-list li:hover { color: #e67e22; font-weight: 500; }
        /* ========== SAƒû ƒ∞√áERƒ∞K (ƒ∞LANLAR) ========== */
        .content-right { flex: 1; background: white; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); padding: 25px; }
        .stats-bar { display: flex; justify-content: space-around; background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 25px; }
        .stat-item { text-align: center; }
        .stat-number { font-size: 28px; font-weight: bold; color: #2c3e50; }
        .stat-label { font-size: 14px; color: #7f8c8d; margin-top: 5px; }
        .add-listing-container { text-align: right; margin-bottom: 20px; }
        .btn-add-listing { background-color: #e67e22; color: white; border: none; padding: 12px 30px; border-radius: 30px; font-size: 16px; font-weight: 600; cursor: pointer; transition: background 0.3s; box-shadow: 0 4px 10px rgba(230,126,34,0.3); }
        .btn-add-listing:hover { background-color: #d35400; }
        .listings-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        .listing-card { background: white; border: 1px solid #eee; border-radius: 10px; overflow: hidden; transition: transform 0.3s, box-shadow 0.3s; cursor: pointer; }
        .listing-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .listing-image { height: 200px; overflow: hidden; }
        .listing-image img { width: 100%; height: 100%; object-fit: cover; }
        .listing-content { padding: 15px; }
        .listing-title { font-size: 18px; font-weight: 600; margin-bottom: 5px; color: #2c3e50; }
        .listing-category { font-size: 13px; color: #e67e22; text-transform: uppercase; margin-bottom: 8px; }
        .listing-price { font-size: 20px; font-weight: bold; color: #27ae60; margin: 10px 0; }
        .listing-location { font-size: 14px; color: #7f8c8d; margin-bottom: 5px; }
        .listing-desc { font-size: 14px; color: #555; margin-bottom: 10px; }
        /* ========== MODALLAR ========== */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 40px; max-width: 500px; width: 90%; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.2); position: relative; max-height: 80vh; overflow-y: auto; }
        .close-modal { position: absolute; top: 15px; right: 20px; font-size: 28px; cursor: pointer; color: #aaa; transition: color 0.2s; }
        .close-modal:hover { color: #e67e22; }
        .modal h2 { margin-bottom: 25px; color: #2c3e50; }
        .modal-form input, .modal-form select, .modal-form textarea { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; font-size: 15px; }
        .modal-form button { width: 100%; padding: 14px; background: #e67e22; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: background 0.3s; }
        .modal-form button:hover { background: #d35400; }
        .modal-footer { margin-top: 20px; text-align: center; color: #7f8c8d; }
        .modal-footer a { color: #e67e22; text-decoration: none; font-weight: 600; cursor: pointer; }
        /* Alt kategori alanƒ± (ƒ∞lan ver modalƒ± i√ßin) */
        #altKategoriContainer { margin: 15px 0; display: none; }
        #altKategoriContainer select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; }
        /* ========== FOOTER ========== */
        .footer { background: #2c3e50; color: #ecf0f1; padding: 50px 0 20px; margin-top: 50px; }
        .footer-container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; padding: 0 20px; }
        .footer-col h4 { font-size: 18px; margin-bottom: 20px; color: #e67e22; }
        .footer-col ul { list-style: none; }
        .footer-col ul li { margin-bottom: 10px; cursor: pointer; transition: color 0.2s; }
        .footer-col ul li:hover { color: #e67e22; }
        .social-icons { display: flex; gap: 15px; margin-top: 15px; }
        .social-icons i { font-size: 24px; cursor: pointer; transition: color 0.2s; }
        .social-icons i:hover { color: #e67e22; }
        .copyright { text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #405b73; font-size: 14px; color: #b0c4de; }
    </style>
</head>
<body>

    <!-- ========== TOPBAR ========== -->
    <div class="topbar">
        <div class="logo" onclick="scrollToTop()">ƒ∞stegelsin<span>.</span></div>
        <div class="search-box">
            <input type="text" placeholder="Ne aramƒ±≈ütƒ±nƒ±z? (√ñrn: Konut, Otomobil, Telefon...)" id="searchInput">
            <button id="searchBtn"><i class="fas fa-search"></i> Ara</button>
        </div>
        <div class="auth-buttons" id="authButtons"></div>
    </div>

    <!-- ========== ANA ƒ∞√áERƒ∞K ========== -->
    <div class="main-container">
        <!-- SOL KATEGORƒ∞ MEN√úS√ú -->
        <div class="categories-sidebar">
            <h3><i class="fas fa-list" style="margin-right: 10px;"></i>Kategoriler</h3>
            
            <div class="category-main">
                <div class="category-header" onclick="toggleSubcategories(this)">
                    Emlak <i class="fas fa-chevron-down"></i>
                </div>
                <ul class="subcategory-list">
                    <li onclick="filterBySubcategory('Konut')">Konut</li>
                    <li onclick="filterBySubcategory('ƒ∞≈ü Yeri')">ƒ∞≈ü Yeri</li>
                    <li onclick="filterBySubcategory('Arsa')">Arsa</li>
                    <li onclick="filterBySubcategory('Konut Projeleri')">Konut Projeleri</li>
                    <li onclick="filterBySubcategory('Bina')">Bina</li>
                    <li onclick="filterBySubcategory('Devre M√ºlk')">Devre M√ºlk</li>
                    <li onclick="filterBySubcategory('Turistik Tesis')">Turistik Tesis</li>
                </ul>
            </div>

            <div class="category-main">
                <div class="category-header" onclick="toggleSubcategories(this)">
                    Vasƒ±ta <i class="fas fa-chevron-down"></i>
                </div>
                <ul class="subcategory-list">
                    <li onclick="filterBySubcategory('Otomobil')">Otomobil</li>
                    <li onclick="filterBySubcategory('Arazi, SUV & Pickup')">Arazi, SUV & Pickup</li>
                    <li onclick="filterBySubcategory('Elektrikli Ara√ßlar')">Elektrikli Ara√ßlar</li>
                    <li onclick="filterBySubcategory('Motosiklet')">Motosiklet</li>
                    <li onclick="filterBySubcategory('Minivan & Panelvan')">Minivan & Panelvan</li>
                    <li onclick="filterBySubcategory('Ticari Ara√ßlar')">Ticari Ara√ßlar</li>
                    <li onclick="filterBySubcategory('Kiralƒ±k Ara√ßlar')">Kiralƒ±k Ara√ßlar</li>
                    <li onclick="filterBySubcategory('Deniz Ara√ßlarƒ±')">Deniz Ara√ßlarƒ±</li>
                    <li onclick="filterBySubcategory('Hasarlƒ± Ara√ßlar')">Hasarlƒ± Ara√ßlar</li>
                </ul>
            </div>

            <div class="category-main">
                <div class="category-header" onclick="toggleSubcategories(this)">
                    ƒ∞kinci El ve Sƒ±fƒ±r <i class="fas fa-chevron-down"></i>
                </div>
                <ul class="subcategory-list">
                    <li onclick="filterBySubcategory('Bilgisayar')">Bilgisayar</li>
                    <li onclick="filterBySubcategory('Telefon')">Telefon</li>
                    <li onclick="filterBySubcategory('Beyaz E≈üya')">Beyaz E≈üya</li>
                    <li onclick="filterBySubcategory('Mobilya')">Mobilya</li>
                </ul>
            </div>

            <div class="category-main">
                <div class="category-header" onclick="toggleSubcategories(this)">
                    Alƒ±≈üveri≈ü <i class="fas fa-chevron-down"></i>
                </div>
                <ul class="subcategory-list">
                    <li onclick="filterBySubcategory('Giyim')">Giyim</li>
                    <li onclick="filterBySubcategory('Ayakkabƒ±')">Ayakkabƒ±</li>
                    <li onclick="filterBySubcategory('Aksesuar')">Aksesuar</li>
                    <li onclick="filterBySubcategory('Kozmetik')">Kozmetik</li>
                </ul>
            </div>

            <div class="category-main">
                <div class="category-header" onclick="toggleSubcategories(this)">
                    End√ºstri Gere√ßleri <i class="fas fa-chevron-down"></i>
                </div>
                <ul class="subcategory-list">
                    <li onclick="filterBySubcategory('Makine')">Makine</li>
                    <li onclick="filterBySubcategory('ƒ∞n≈üaat')">ƒ∞n≈üaat</li>
                    <li onclick="filterBySubcategory('Elektrik')">Elektrik</li>
                </ul>
            </div>

            <div class="category-main">
                <div class="category-header" onclick="toggleSubcategories(this)">
                    Hizmetler <i class="fas fa-chevron-down"></i>
                </div>
                <ul class="subcategory-list">
                    <li onclick="filterBySubcategory('Tamir')">Tamir</li>
                    <li onclick="filterBySubcategory('Temizlik')">Temizlik</li>
                    <li onclick="filterBySubcategory('Nakliyat')">Nakliyat</li>
                </ul>
            </div>

            <div class="category-main">
                <div class="category-header" onclick="toggleSubcategories(this)">
                    Ustalar ve √ñzel Ders <i class="fas fa-chevron-down"></i>
                </div>
                <ul class="subcategory-list">
                    <li onclick="filterBySubcategory('Elektrik√ßi')">Elektrik√ßi</li>
                    <li onclick="filterBySubcategory('Tesisat√ßƒ±')">Tesisat√ßƒ±</li>
                    <li onclick="filterBySubcategory('Matematik Dersi')">Matematik Dersi</li>
                </ul>
            </div>

            <div class="category-main">
                <div class="category-header" onclick="toggleSubcategories(this)">
                    ƒ∞≈ü ƒ∞lanlarƒ± <i class="fas fa-chevron-down"></i>
                </div>
                <ul class="subcategory-list">
                    <li onclick="filterBySubcategory('Satƒ±≈ü')">Satƒ±≈ü</li>
                    <li onclick="filterBySubcategory('Yazƒ±lƒ±m')">Yazƒ±lƒ±m</li>
                    <li onclick="filterBySubcategory('Muhasebe')">Muhasebe</li>
                </ul>
            </div>
        </div>

        <!-- SAƒû ƒ∞√áERƒ∞K (ƒ∞LANLAR) -->
        <div class="content-right">
            <!-- ƒ∞statistikler -->
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-number">24</div>
                    <div class="stat-label">B√∂lge</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="userCount">1200+</div>
                    <div class="stat-label">√úye</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="listingCount">0</div>
                    <div class="stat-label">ƒ∞lan</div>
                </div>
            </div>

            <!-- ƒ∞lan Ver Butonu -->
            <div class="add-listing-container" id="addListingContainer" style="display: none;">
                <button class="btn-add-listing" id="addListingBtn"><i class="fas fa-plus-circle"></i> ƒ∞LAN VER</button>
            </div>

            <!-- ƒ∞lan Listesi -->
            <div class="listings-grid" id="allListings">
                <!-- ƒ∞lanlar buraya gelecek -->
            </div>
        </div>
    </div>

    <!-- ========== FOOTER ========== -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-col">
                <h4>Kurumsal</h4>
                <ul>
                    <li onclick="alert('Hakkƒ±mƒ±zda sayfasƒ± √ßok yakƒ±nda!')">Hakkƒ±mƒ±zda</li>
                    <li onclick="alert('ƒ∞leti≈üim bilgileri: info@istegelsin.com')">ƒ∞leti≈üim</li>
                    <li onclick="alert('Kariyer sayfasƒ± √ßok yakƒ±nda!')">Kariyer</li>
                    <li onclick="alert('Reklam ve ƒ∞≈ü birlikleri i√ßin: reklam@istegelsin.com')">Reklam</li>
                </ul>
            </div>
            <div class="footer-col">
                <h4>Gizlilik ve Kullanƒ±m</h4>
                <ul>
                    <li onclick="alert('Gizlilik politikasƒ± metni burada yer alacak.')">Gizlilik Politikasƒ±</li>
                    <li onclick="alert('Kullanƒ±m ko≈üullarƒ± metni burada yer alacak.')">Kullanƒ±m Ko≈üullarƒ±</li>
                    <li onclick="alert('√áerez politikasƒ± metni burada yer alacak.')">√áerez Politikasƒ±</li>
                    <li onclick="alert('KVKK metni burada yer alacak.')">KVKK</li>
                </ul>
            </div>
            <div class="footer-col">
                <h4>Bizi Takip Edin</h4>
                <ul>
                    <li><i class="fab fa-facebook"></i> Facebook</li>
                    <li><i class="fab fa-twitter"></i> Twitter</li>
                    <li><i class="fab fa-instagram"></i> Instagram</li>
                    <li><i class="fab fa-youtube"></i> YouTube</li>
                </ul>
                <div class="social-icons">
                    <i class="fab fa-facebook" onclick="window.open('https://facebook.com', '_blank')"></i>
                    <i class="fab fa-twitter" onclick="window.open('https://twitter.com', '_blank')"></i>
                    <i class="fab fa-instagram" onclick="window.open('https://instagram.com', '_blank')"></i>
                    <i class="fab fa-youtube" onclick="window.open('https://youtube.com', '_blank')"></i>
                </div>
            </div>
        </div>
        <div class="copyright">
            ¬© 2025 ƒ∞stegelsin. T√ºm haklarƒ± saklƒ±dƒ±r.
        </div>
    </footer>

    <!-- ========== MODALLAR ========== -->
    <!-- √úye Ol Modal -->
    <div id="signupModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeSignup">&times;</span>
            <h2><i class="fas fa-user-plus" style="margin-right: 10px;"></i>√úye Ol</h2>
            <form class="modal-form" id="signupForm">
                <input type="text" id="signupName" placeholder="Ad Soyad" required>
                <input type="email" id="signupEmail" placeholder="E-posta" required>
                <input type="password" id="signupPassword" placeholder="≈ûifre" required>
                <button type="submit">KAYIT OL</button>
            </form>
            <div class="modal-footer">Zaten √ºye misiniz? <a id="goToLogin">Giri≈ü Yap</a></div>
        </div>
    </div>

    <!-- Giri≈ü Yap Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeLogin">&times;</span>
            <h2><i class="fas fa-sign-in-alt" style="margin-right: 10px;"></i>Giri≈ü Yap</h2>
            <form class="modal-form" id="loginForm">
                <input type="email" id="loginEmail" placeholder="E-posta" required>
                <input type="password" id="loginPassword" placeholder="≈ûifre" required>
                <button type="submit">Gƒ∞Rƒ∞≈û</button>
            </form>
            <div class="modal-footer">Hesabƒ±nƒ±z yok mu? <a id="goToSignup">√úye Ol</a></div>
        </div>
    </div>

    <!-- ƒ∞lan Ekle Modal -->
    <div id="addListingModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeAddListing">&times;</span>
            <h2><i class="fas fa-plus-circle" style="margin-right: 10px;"></i>ƒ∞lan Ver</h2>
            <form class="modal-form" id="addListingForm">
                <!-- Ana Kategori -->
                <select id="mainCategory" required onchange="updateSubcategories()">
                    <option value="">Ana Kategori Se√ßin</option>
                    <option value="emlak">Emlak</option>
                    <option value="vasita">Vasƒ±ta</option>
                    <option value="ikinciel">ƒ∞kinci El ve Sƒ±fƒ±r</option>
                    <option value="alisveris">Alƒ±≈üveri≈ü</option>
                    <option value="endustri">End√ºstri Gere√ßleri</option>
                    <option value="hizmetler">Hizmetler</option>
                    <option value="ustalar">Ustalar ve √ñzel Ders</option>
                    <option value="is">ƒ∞≈ü ƒ∞lanlarƒ±</option>
                </select>

                <!-- Alt Kategori (dinamik doldurulacak) -->
                <div id="altKategoriContainer">
                    <select id="subCategory" required>
                        <option value="">Alt Kategori Se√ßin</option>
                    </select>
                </div>

                <input type="text" id="listingTitle" placeholder="ƒ∞lan Ba≈ülƒ±ƒüƒ±" required>
                <input type="text" id="listingLocation" placeholder="Konum (≈üehir, mahalle)" required>
                <input type="number" id="listingPrice" placeholder="Fiyat (TL veya EUR)" required>
                <textarea id="listingDescription" placeholder="ƒ∞lan A√ßƒ±klamasƒ±" rows="3" required></textarea>
                <input type="url" id="listingImage" placeholder="Resim URL'si (zorunlu deƒüil)">

                <button type="submit">ƒ∞LANI YAYINLA</button>
            </form>
        </div>
    </div>

    <!-- ========== SUPABASE BAƒûLANTI VE T√úM FONKSƒ∞YONLAR ========== -->
    <script>
        (function() {
            // ---------- SUPABASE BAƒûLANTI Bƒ∞LGƒ∞LERƒ∞ ----------
            const SUPABASE_URL = 'https://sbubvjeguxuqgiklrajk.supabase.co';
            const SUPABASE_ANON_KEY = 'sb_publishable_Ic1qJb5_ljG05NTafWt9ww_2UGX6Xqa';
            // -----------------------------------------------

            const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

            // ---------- YARDIMCI FONKSƒ∞YONLAR ----------
            window.scrollToTop = () => window.scrollTo({ top: 0, behavior: 'smooth' });

            // ---------- MODAL ELEMENTLERƒ∞ ----------
            const signupModal = document.getElementById('signupModal');
            const loginModal = document.getElementById('loginModal');
            const addListingModal = document.getElementById('addListingModal');
            const addListingContainer = document.getElementById('addListingContainer');
            const closeSignup = document.getElementById('closeSignup');
            const closeLogin = document.getElementById('closeLogin');
            const closeAddListing = document.getElementById('closeAddListing');
            const goToLogin = document.getElementById('goToLogin');
            const goToSignup = document.getElementById('goToSignup');
            const addListingBtn = document.getElementById('addListingBtn');

            const openModal = (modal) => modal.style.display = 'flex';
            const closeModal = (modal) => modal.style.display = 'none';

            // Modal dƒ±≈üƒ±na tƒ±klayƒ±nca kapat
            window.addEventListener('click', (e) => {
                if (e.target === signupModal) closeModal(signupModal);
                if (e.target === loginModal) closeModal(loginModal);
                if (e.target === addListingModal) closeModal(addListingModal);
            });

            closeSignup.addEventListener('click', () => closeModal(signupModal));
            closeLogin.addEventListener('click', () => closeModal(loginModal));
            closeAddListing.addEventListener('click', () => closeModal(addListingModal));

            goToLogin.addEventListener('click', (e) => {
                e.preventDefault();
                closeModal(signupModal);
                openModal(loginModal);
            });

            goToSignup.addEventListener('click', (e) => {
                e.preventDefault();
                closeModal(loginModal);
                openModal(signupModal);
            });

            // ---------- AUTH DURUMU ƒ∞ZLEME ----------
            supabase.auth.onAuthStateChange((event, session) => {
                const user = session?.user;
                const authButtonsDiv = document.getElementById('authButtons');

                if (user) {
                    authButtonsDiv.innerHTML = `
                        <div class="user-info">
                            <span>üëã ${user.email}</span>
                            <button id="logoutBtn">√áƒ±kƒ±≈ü</button>
                        </div>
                    `;
                    document.getElementById('logoutBtn').addEventListener('click', () => supabase.auth.signOut());
                    addListingContainer.style.display = 'block';
                } else {
                    authButtonsDiv.innerHTML = `
                        <button id="loginBtn">Giri≈ü Yap</button>
                        <button id="signupBtn">√úye Ol</button>
                    `;
                    document.getElementById('loginBtn').addEventListener('click', () => openModal(loginModal));
                    document.getElementById('signupBtn').addEventListener('click', () => openModal(signupModal));
                    addListingContainer.style.display = 'none';
                }
            });

            // ---------- √úYE OL ----------
            document.getElementById('signupForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('signupEmail').value;
                const password = document.getElementById('signupPassword').value;
                const name = document.getElementById('signupName').value;

                const { error } = await supabase.auth.signUp({
                    email,
                    password,
                    options: { data: { full_name: name } }
                });

                if (error) alert('Hata: ' + error.message);
                else {
                    alert('Kayƒ±t ba≈üarƒ±lƒ±! L√ºtfen e-postanƒ±zƒ± onaylayƒ±n.');
                    closeModal(signupModal);
                }
            });

            // ---------- Gƒ∞Rƒ∞≈û YAP ----------
            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;

                const { error } = await supabase.auth.signInWithPassword({ email, password });
                if (error) alert('Hata: ' + error.message);
                else {
                    alert('Giri≈ü ba≈üarƒ±lƒ±!');
                    closeModal(loginModal);
                }
            });

            // ---------- ƒ∞LAN EKLEME ----------
            addListingBtn.addEventListener('click', () => {
                openModal(addListingModal);
                // Alt kategori container'ƒ±nƒ± sƒ±fƒ±rla
                document.getElementById('altKategoriContainer').style.display = 'none';
                document.getElementById('subCategory').innerHTML = '<option value="">Alt Kategori Se√ßin</option>';
            });

            // Alt kategori g√ºncelleme fonksiyonu
            window.updateSubcategories = function() {
                const mainCat = document.getElementById('mainCategory').value;
                const subSelect = document.getElementById('subCategory');
                const container = document.getElementById('altKategoriContainer');
                
                // Alt kategori listeleri
                const subCategories = {
                    emlak: ['Konut', 'ƒ∞≈ü Yeri', 'Arsa', 'Konut Projeleri', 'Bina', 'Devre M√ºlk', 'Turistik Tesis'],
                    vasita: ['Otomobil', 'Arazi, SUV & Pickup', 'Elektrikli Ara√ßlar', 'Motosiklet', 'Minivan & Panelvan', 'Ticari Ara√ßlar', 'Kiralƒ±k Ara√ßlar', 'Deniz Ara√ßlarƒ±', 'Hasarlƒ± Ara√ßlar'],
                    ikinciel: ['Bilgisayar', 'Telefon', 'Beyaz E≈üya', 'Mobilya'],
                    alisveris: ['Giyim', 'Ayakkabƒ±', 'Aksesuar', 'Kozmetik'],
                    endustri: ['Makine', 'ƒ∞n≈üaat', 'Elektrik'],
                    hizmetler: ['Tamir', 'Temizlik', 'Nakliyat'],
                    ustalar: ['Elektrik√ßi', 'Tesisat√ßƒ±', 'Matematik Dersi'],
                    is: ['Satƒ±≈ü', 'Yazƒ±lƒ±m', 'Muhasebe']
                };

                if (mainCat && subCategories[mainCat]) {
                    let options = '<option value="">Alt Kategori Se√ßin</option>';
                    subCategories[mainCat].forEach(cat => {
                        options += `<option value="${cat}">${cat}</option>`;
                    });
                    subSelect.innerHTML = options;
                    container.style.display = 'block';
                } else {
                    container.style.display = 'none';
                }
            };

            document.getElementById('addListingForm').addEventListener('submit', async (e) => {
                e.preventDefault();

                const { data: { user } } = await supabase.auth.getUser();
                if (!user) {
                    alert('√ñnce giri≈ü yapmalƒ±sƒ±nƒ±z!');
                    closeModal(addListingModal);
                    return;
                }

                const mainCategory = document.getElementById('mainCategory').value;
                const subCategory = document.getElementById('subCategory').value;
                const title = document.getElementById('listingTitle').value;
                const location = document.getElementById('listingLocation').value;
                const price = document.getElementById('listingPrice').value;
                const description = document.getElementById('listingDescription').value;
                const imageUrl = document.getElementById('listingImage').value || 'https://via.placeholder.com/400x250';

                if (!mainCategory || !subCategory) {
                    alert('L√ºtfen kategori se√ßin!');
                    return;
                }

                // √ñzellikler (kategoriye g√∂re doldurulabilir, ≈üimdilik bo≈ü)
                const ozellikler = {};

                const { error } = await supabase.from('ilanlar').insert([
                    {
                        baslik: title,
                        kategori: mainCategory,
                        alt_kategori: subCategory,
                        fiyat: price + ' TL',
                        aciklama: description,
                        resim_url: imageUrl,
                        konum: location,
                        ozellikler: ozellikler,
                        user_id: user.id
                    }
                ]);

                if (error) alert('Hata: ' + error.message);
                else {
                    alert('ƒ∞lan ba≈üarƒ±yla eklendi!');
                    closeModal(addListingModal);
                    document.getElementById('addListingForm').reset();
                    document.getElementById('altKategoriContainer').style.display = 'none';
                    loadListings();
                }
            });

            // ---------- ƒ∞LANLARI Lƒ∞STELE ----------
            async function loadListings() {
                const { data: ilanlar, error } = await supabase
                    .from('ilanlar')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) {
                    console.error('ƒ∞lanlar y√ºklenemedi:', error);
                    return;
                }

                document.getElementById('listingCount').textContent = ilanlar.length;

                const allGrid = document.getElementById('allListings');

                if (ilanlar.length === 0) {
                    allGrid.innerHTML = '<p style="text-align:center; grid-column:1/-1;">Hen√ºz ilan bulunmuyor. ƒ∞lk ilanƒ± siz verin!</p>';
                    return;
                }

                function renderCard(item) {
                    return `
                        <div class="listing-card">
                            <div class="listing-image">
                                <img src="${item.resim_url || 'https://via.placeholder.com/400x250'}" alt="${item.baslik}">
                            </div>
                            <div class="listing-content">
                                <div class="listing-title">${item.baslik}</div>
                                <div class="listing-category">${item.alt_kategori || item.kategori}</div>
                                <div class="listing-price">${item.fiyat}</div>
                                <div class="listing-location">üìç ${item.konum || 'Konum belirtilmemi≈ü'}</div>
                                <div class="listing-desc">${item.aciklama.substring(0, 60)}...</div>
                            </div>
                        </div>
                    `;
                }

                allGrid.innerHTML = ilanlar.map(renderCard).join('');
            }

            // ---------- KATEGORƒ∞ FONKSƒ∞YONLARI ----------
            // Alt kategorileri a√ß/kapat
            window.toggleSubcategories = function(header) {
                const sublist = header.nextElementSibling;
                const icon = header.querySelector('i');
                if (sublist.classList.contains('show')) {
                    sublist.classList.remove('show');
                    icon.style.transform = 'rotate(0deg)';
                } else {
                    sublist.classList.add('show');
                    icon.style.transform = 'rotate(180deg)';
                }
            };

            // Alt kategori filtresi (≈üimdilik uyarƒ±, ileride filtreleme yapacak)
            window.filterBySubcategory = function(subcategory) {
                alert(`"${subcategory}" kategorisindeki ilanlar listeleniyor (filteleme fonksiyonu eklenecek).`);
                // ƒ∞leride burada supabase sorgusu yapƒ±p listeyi g√ºncelleyeceƒüiz
                // √ñrnek: loadListingsBySubcategory(subcategory);
            };

            // Sayfa y√ºklenince ilanlarƒ± getir
            loadListings();

            // Arama butonu (≈üimdilik uyarƒ±)
            document.getElementById('searchBtn').addEventListener('click', () => {
                const query = document.getElementById('searchInput').value;
                if (query) alert(`"${query}" aramasƒ± yapƒ±lƒ±yor (arama fonksiyonu eklenecek).`);
            });

        })();
    </script>
</body>
</html>
