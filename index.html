<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¹Ù‚Ø§Ø±Ø§Øª ØªÙˆÙ†Ø³ | Akarat Tunisia</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<style>
  :root {
    --primary: #C4953A;
    --primary-dark: #9E7830;
    --primary-light: #F0D49A;
    --dark: #1A1208;
    --dark2: #2C1F0A;
    --mid: #4A3518;
    --surface: #FDF6EB;
    --surface2: #F5E8CC;
    --text: #2C1F0A;
    --text-light: #7A6040;
    --white: #FFFFFF;
    --success: #2D8A4E;
    --error: #C0392B;
    --shadow: 0 4px 24px rgba(196,149,58,0.15);
    --radius: 16px;
    --radius-sm: 8px;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    font-family: 'Cairo', 'Tajawal', sans-serif;
    background: var(--surface);
    color: var(--text);
    min-height: 100vh;
    direction: rtl;
  }

  /* ===== NAVBAR ===== */
  nav {
    background: var(--dark);
    padding: 0 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 64px;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: 0 2px 20px rgba(0,0,0,0.4);
  }
  .logo {
    font-family: 'Tajawal', sans-serif;
    font-size: 22px;
    font-weight: 800;
    color: var(--primary);
    letter-spacing: -0.5px;
    cursor: pointer;
  }
  .logo span { color: var(--white); }
  .nav-links {
    display: flex;
    gap: 8px;
    align-items: center;
  }
  .nav-btn {
    background: none;
    border: none;
    color: #ccc;
    font-family: 'Cairo', sans-serif;
    font-size: 14px;
    padding: 8px 16px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .nav-btn:hover { color: var(--primary); background: rgba(196,149,58,0.1); }
  .nav-btn.active { color: var(--primary); }
  .btn-primary {
    background: var(--primary);
    color: var(--dark);
    font-weight: 700;
    border-radius: 8px;
    border: none;
    padding: 9px 20px;
    font-family: 'Cairo', sans-serif;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .btn-primary:hover { background: var(--primary-dark); color: white; }

  /* ===== PAGES ===== */
  .page { display: none; }
  .page.active { display: block; }

  /* ===== HERO ===== */
  .hero {
    background: linear-gradient(135deg, var(--dark) 0%, var(--dark2) 50%, #3D2A0F 100%);
    padding: 80px 24px 60px;
    text-align: center;
    position: relative;
    overflow: hidden;
  }
  .hero::before {
    content: '';
    position: absolute;
    inset: 0;
    background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23C4953A' fill-opacity='0.06'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
  }
  .hero h1 {
    font-family: 'Tajawal', sans-serif;
    font-size: clamp(28px, 5vw, 52px);
    font-weight: 800;
    color: var(--white);
    margin-bottom: 12px;
    position: relative;
  }
  .hero h1 span { color: var(--primary); }
  .hero p {
    color: #aaa;
    font-size: 16px;
    margin-bottom: 36px;
    position: relative;
  }
  .search-bar {
    background: white;
    border-radius: 16px;
    padding: 8px;
    display: flex;
    gap: 8px;
    max-width: 700px;
    margin: 0 auto 32px;
    position: relative;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
  }
  .search-bar input {
    flex: 1;
    border: none;
    outline: none;
    font-family: 'Cairo', sans-serif;
    font-size: 15px;
    padding: 10px 16px;
    direction: rtl;
    color: var(--text);
  }
  .search-bar select {
    border: none;
    outline: none;
    font-family: 'Cairo', sans-serif;
    font-size: 14px;
    padding: 8px 12px;
    background: var(--surface2);
    border-radius: 10px;
    color: var(--text);
    cursor: pointer;
  }
  .search-bar button {
    background: var(--primary);
    color: var(--dark);
    border: none;
    padding: 10px 24px;
    border-radius: 10px;
    font-family: 'Cairo', sans-serif;
    font-weight: 700;
    font-size: 15px;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }
  .search-bar button:hover { background: var(--primary-dark); color: white; }
  .hero-stats {
    display: flex;
    justify-content: center;
    gap: 40px;
    position: relative;
    flex-wrap: wrap;
  }
  .hero-stat { text-align: center; }
  .hero-stat .num { font-size: 28px; font-weight: 800; color: var(--primary); }
  .hero-stat .lbl { font-size: 13px; color: #999; }

  /* ===== FILTERS ===== */
  .filters-bar {
    background: white;
    border-bottom: 1px solid var(--surface2);
    padding: 16px 24px;
    display: flex;
    gap: 12px;
    align-items: center;
    flex-wrap: wrap;
    position: sticky;
    top: 64px;
    z-index: 100;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  }
  .filter-select {
    border: 1.5px solid var(--surface2);
    outline: none;
    font-family: 'Cairo', sans-serif;
    font-size: 13px;
    padding: 8px 14px;
    border-radius: 10px;
    background: var(--surface);
    color: var(--text);
    cursor: pointer;
    transition: border 0.2s;
  }
  .filter-select:focus { border-color: var(--primary); }
  .filter-btn {
    border: 1.5px solid var(--surface2);
    background: var(--surface);
    font-family: 'Cairo', sans-serif;
    font-size: 13px;
    padding: 8px 14px;
    border-radius: 10px;
    cursor: pointer;
    color: var(--text);
    transition: all 0.2s;
  }
  .filter-btn:hover, .filter-btn.active { border-color: var(--primary); background: var(--primary-light); color: var(--primary-dark); }
  .view-toggle { margin-right: auto; display: flex; gap: 4px; }
  .view-btn {
    background: none;
    border: 1.5px solid var(--surface2);
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.2s;
    color: var(--text-light);
  }
  .view-btn.active { border-color: var(--primary); background: var(--primary-light); color: var(--primary-dark); }

  /* ===== LISTINGS ===== */
  .listings-container { padding: 24px; max-width: 1200px; margin: 0 auto; }
  .listings-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
  }
  .listings-list .listing-card {
    display: flex;
    flex-direction: row;
    height: 160px;
  }
  .listings-list .listing-card .card-img {
    width: 200px;
    height: 160px;
    flex-shrink: 0;
    border-radius: var(--radius) 0 0 var(--radius);
  }
  .listings-list .listing-card .card-body {
    flex: 1;
    border-radius: 0 var(--radius) var(--radius) 0;
  }

  .listing-card {
    background: white;
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: var(--shadow);
    transition: transform 0.2s, box-shadow 0.2s;
    cursor: pointer;
    position: relative;
  }
  .listing-card:hover { transform: translateY(-4px); box-shadow: 0 12px 40px rgba(196,149,58,0.25); }
  .card-img {
    width: 100%;
    height: 200px;
    object-fit: cover;
    background: linear-gradient(135deg, #e8d5b0, #d4b880);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 48px;
    position: relative;
  }
  .card-badge {
    position: absolute;
    top: 12px;
    right: 12px;
    background: var(--primary);
    color: var(--dark);
    font-size: 12px;
    font-weight: 700;
    padding: 4px 10px;
    border-radius: 20px;
  }
  .card-badge.rent { background: #2D8A4E; color: white; }
  .card-fav {
    position: absolute;
    top: 12px;
    left: 12px;
    background: white;
    border: none;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    transition: transform 0.2s;
  }
  .card-fav:hover { transform: scale(1.2); }
  .card-body { padding: 16px; }
  .card-price {
    font-size: 20px;
    font-weight: 800;
    color: var(--primary-dark);
    margin-bottom: 6px;
  }
  .card-price span { font-size: 13px; font-weight: 400; color: var(--text-light); }
  .card-title {
    font-size: 15px;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 6px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .card-location {
    font-size: 13px;
    color: var(--text-light);
    display: flex;
    align-items: center;
    gap: 4px;
    margin-bottom: 10px;
  }
  .card-features {
    display: flex;
    gap: 12px;
    font-size: 12px;
    color: var(--text-light);
    border-top: 1px solid var(--surface2);
    padding-top: 10px;
  }
  .card-feature { display: flex; align-items: center; gap: 4px; }

  /* ===== MAP VIEW ===== */
  #map { height: calc(100vh - 140px); width: 100%; }
  .map-page { display: none; }
  .map-page.active { display: block; }

  /* ===== MODAL ===== */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    z-index: 2000;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }
  .modal-overlay.open { display: flex; }
  .modal {
    background: white;
    border-radius: 20px;
    max-width: 540px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
    animation: modalIn 0.3s ease;
  }
  @keyframes modalIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
  .modal-close {
    position: absolute;
    top: 16px;
    left: 16px;
    background: var(--surface2);
    border: none;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1;
    transition: background 0.2s;
  }
  .modal-close:hover { background: #ddd; }
  .modal-img {
    width: 100%;
    height: 220px;
    background: linear-gradient(135deg, #e8d5b0, #d4b880);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 72px;
    border-radius: 20px 20px 0 0;
  }
  .modal-body { padding: 24px; }
  .modal-price { font-size: 26px; font-weight: 800; color: var(--primary-dark); margin-bottom: 4px; }
  .modal-title { font-size: 18px; font-weight: 700; margin-bottom: 8px; }
  .modal-location { font-size: 14px; color: var(--text-light); margin-bottom: 16px; }
  .modal-features {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-bottom: 16px;
  }
  .modal-feature {
    background: var(--surface);
    border-radius: 10px;
    padding: 12px;
    text-align: center;
  }
  .modal-feature .icon { font-size: 22px; margin-bottom: 4px; }
  .modal-feature .label { font-size: 11px; color: var(--text-light); }
  .modal-feature .val { font-size: 14px; font-weight: 700; }
  .modal-desc { font-size: 14px; color: var(--text-light); line-height: 1.8; margin-bottom: 20px; }
  .modal-contact {
    display: flex;
    gap: 10px;
  }
  .btn-call {
    flex: 1;
    background: var(--success);
    color: white;
    border: none;
    padding: 14px;
    border-radius: 12px;
    font-family: 'Cairo', sans-serif;
    font-size: 15px;
    font-weight: 700;
    cursor: pointer;
    transition: opacity 0.2s;
  }
  .btn-call:hover { opacity: 0.9; }
  .btn-whatsapp {
    flex: 1;
    background: #25D366;
    color: white;
    border: none;
    padding: 14px;
    border-radius: 12px;
    font-family: 'Cairo', sans-serif;
    font-size: 15px;
    font-weight: 700;
    cursor: pointer;
  }

  /* ===== AUTH MODAL ===== */
  .auth-tabs { display: flex; border-bottom: 2px solid var(--surface2); margin-bottom: 24px; }
  .auth-tab {
    flex: 1;
    padding: 12px;
    text-align: center;
    cursor: pointer;
    font-weight: 600;
    color: var(--text-light);
    transition: all 0.2s;
    font-size: 15px;
  }
  .auth-tab.active { color: var(--primary-dark); border-bottom: 2px solid var(--primary); margin-bottom: -2px; }
  .form-group { margin-bottom: 16px; }
  .form-group label { display: block; font-size: 13px; font-weight: 600; color: var(--text-light); margin-bottom: 6px; }
  .form-input {
    width: 100%;
    border: 1.5px solid var(--surface2);
    border-radius: 10px;
    padding: 12px 16px;
    font-family: 'Cairo', sans-serif;
    font-size: 14px;
    outline: none;
    transition: border 0.2s;
    direction: rtl;
    color: var(--text);
  }
  .form-input:focus { border-color: var(--primary); }
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  textarea.form-input { resize: vertical; min-height: 100px; }

  /* ===== ADD LISTING ===== */
  .add-listing-page { max-width: 700px; margin: 0 auto; padding: 32px 24px; }
  .page-title { font-size: 24px; font-weight: 800; margin-bottom: 8px; color: var(--text); }
  .page-subtitle { font-size: 14px; color: var(--text-light); margin-bottom: 32px; }
  .form-card { background: white; border-radius: var(--radius); padding: 24px; box-shadow: var(--shadow); margin-bottom: 20px; }
  .form-card-title { font-size: 16px; font-weight: 700; margin-bottom: 20px; color: var(--text); display: flex; align-items: center; gap: 8px; }
  .photo-upload {
    border: 2px dashed var(--primary-light);
    border-radius: 12px;
    padding: 32px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    background: var(--surface);
  }
  .photo-upload:hover { border-color: var(--primary); background: var(--primary-light); }
  .photo-upload .icon { font-size: 40px; margin-bottom: 8px; }
  .photo-upload p { font-size: 14px; color: var(--text-light); }
  .submit-btn {
    width: 100%;
    background: var(--primary);
    color: var(--dark);
    border: none;
    padding: 16px;
    border-radius: 12px;
    font-family: 'Cairo', sans-serif;
    font-size: 16px;
    font-weight: 800;
    cursor: pointer;
    transition: all 0.2s;
  }
  .submit-btn:hover { background: var(--primary-dark); color: white; }

  /* ===== TOAST ===== */
  .toast {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: var(--dark);
    color: white;
    padding: 14px 28px;
    border-radius: 50px;
    font-size: 14px;
    font-weight: 600;
    z-index: 9999;
    transition: transform 0.3s;
    white-space: nowrap;
  }
  .toast.show { transform: translateX(-50%) translateY(0); }

  /* ===== PROFILE ===== */
  .profile-page { max-width: 700px; margin: 0 auto; padding: 32px 24px; }
  .profile-header {
    background: linear-gradient(135deg, var(--dark), var(--dark2));
    border-radius: var(--radius);
    padding: 32px;
    text-align: center;
    margin-bottom: 24px;
    color: white;
  }
  .profile-avatar {
    width: 80px;
    height: 80px;
    background: var(--primary);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 36px;
    margin: 0 auto 16px;
  }
  .profile-name { font-size: 22px; font-weight: 800; margin-bottom: 4px; }
  .profile-email { font-size: 14px; color: #aaa; }
  .my-listings-title { font-size: 18px; font-weight: 700; margin-bottom: 16px; }

  /* ===== EMPTY STATE ===== */
  .empty-state { text-align: center; padding: 60px 24px; color: var(--text-light); }
  .empty-state .icon { font-size: 60px; margin-bottom: 16px; }
  .empty-state h3 { font-size: 18px; font-weight: 700; margin-bottom: 8px; color: var(--text); }
  .empty-state p { font-size: 14px; }

  /* ===== MOBILE ===== */
  @media (max-width: 600px) {
    .hero { padding: 48px 16px 40px; }
    .search-bar { flex-wrap: wrap; }
    .hero-stats { gap: 24px; }
    .filters-bar { padding: 12px 16px; gap: 8px; }
    .listings-container { padding: 16px; }
    .modal-features { grid-template-columns: repeat(2, 1fr); }
    .form-row { grid-template-columns: 1fr; }
    .nav-links .nav-btn { display: none; }
  }

  .results-count { font-size: 14px; color: var(--text-light); margin-bottom: 16px; }
  
  /* Floating Add Button */
  .fab {
    position: fixed;
    bottom: 28px;
    left: 28px;
    background: var(--primary);
    color: var(--dark);
    border: none;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    font-size: 24px;
    cursor: pointer;
    box-shadow: 0 4px 20px rgba(196,149,58,0.5);
    z-index: 500;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }
  .fab:hover { transform: scale(1.1); background: var(--primary-dark); color: white; }
</style>
</head>
<body>

<!-- NAVBAR -->
<nav>
  <div class="logo" onclick="showPage('home')">Ø¹Ù‚Ø§Ø±Ø§Øª <span>ØªÙˆÙ†Ø³</span></div>
  <div class="nav-links">
    <button class="nav-btn active" onclick="showPage('home'); setActive(this)">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button class="nav-btn" onclick="showPage('listings'); setActive(this)">Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</button>
    <button class="nav-btn" onclick="showPage('map-view'); setActive(this)">Ø§Ù„Ø®Ø±ÙŠØ·Ø©</button>
    <button class="nav-btn" onclick="showPage('add'); setActive(this)">Ø£Ø¶Ù Ø¥Ø¹Ù„Ø§Ù†</button>
    <button class="btn-primary" onclick="openAuth()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
  </div>
</nav>

<!-- HOME PAGE -->
<div id="page-home" class="page active">
  <div class="hero">
    <h1>Ø§Ø¨Ø­Ø« Ø¹Ù† <span>Ù…Ù†Ø²Ù„ Ø£Ø­Ù„Ø§Ù…Ùƒ</span><br>ÙÙŠ ØªÙˆÙ†Ø³</h1>
    <p>Ø¢Ù„Ø§Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ© ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø£Ù†Ø­Ø§Ø¡ ØªÙˆÙ†Ø³</p>
    <div class="search-bar">
      <input type="text" id="heroSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø£Ùˆ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©..." />
      <select id="heroType">
        <option value="">ÙƒÙ„ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
        <option value="sale">Ø¨ÙŠØ¹</option>
        <option value="rent">Ø¥ÙŠØ¬Ø§Ø±</option>
      </select>
      <button onclick="doHeroSearch()">ğŸ” Ø¨Ø­Ø«</button>
    </div>
    <div class="hero-stats">
      <div class="hero-stat"><div class="num" id="totalCount">0</div><div class="lbl">Ø¥Ø¹Ù„Ø§Ù† Ù†Ø´Ø·</div></div>
      <div class="hero-stat"><div class="num">24</div><div class="lbl">Ù…Ø¯ÙŠÙ†Ø©</div></div>
      <div class="hero-stat"><div class="num">1200+</div><div class="lbl">Ù…Ø³ØªØ®Ø¯Ù…</div></div>
    </div>
  </div>

  <!-- Featured -->
  <div class="listings-container">
    <div class="results-count">Ø£Ø­Ø¯Ø« Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</div>
    <div class="listings-grid" id="featuredGrid"></div>
  </div>
</div>

<!-- LISTINGS PAGE -->
<div id="page-listings" class="page">
  <div class="filters-bar">
    <select class="filter-select" id="fType" onchange="applyFilters()">
      <option value="">ÙƒÙ„ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
      <option value="sale">Ø¨ÙŠØ¹</option>
      <option value="rent">Ø¥ÙŠØ¬Ø§Ø±</option>
    </select>
    <select class="filter-select" id="fCat" onchange="applyFilters()">
      <option value="">ÙƒÙ„ Ø§Ù„ÙØ¦Ø§Øª</option>
      <option value="apartment">Ø´Ù‚Ø©</option>
      <option value="villa">ÙÙŠÙ„Ø§</option>
      <option value="house">Ù…Ù†Ø²Ù„</option>
      <option value="land">Ø£Ø±Ø¶</option>
      <option value="commercial">ØªØ¬Ø§Ø±ÙŠ</option>
    </select>
    <select class="filter-select" id="fCity" onchange="applyFilters()">
      <option value="">ÙƒÙ„ Ø§Ù„Ù…Ø¯Ù†</option>
      <option value="ØªÙˆÙ†Ø³">ØªÙˆÙ†Ø³ Ø§Ù„Ø¹Ø§ØµÙ…Ø©</option>
      <option value="ØµÙØ§Ù‚Ø³">ØµÙØ§Ù‚Ø³</option>
      <option value="Ø³ÙˆØ³Ø©">Ø³ÙˆØ³Ø©</option>
      <option value="Ø¨Ù†Ø²Ø±Øª">Ø¨Ù†Ø²Ø±Øª</option>
      <option value="Ù†Ø§Ø¨Ù„">Ù†Ø§Ø¨Ù„</option>
      <option value="Ø§Ù„Ù…Ù†Ø³ØªÙŠØ±">Ø§Ù„Ù…Ù†Ø³ØªÙŠØ±</option>
      <option value="Ù‚Ø§Ø¨Ø³">Ù‚Ø§Ø¨Ø³</option>
      <option value="Ù…Ø¯Ù†ÙŠÙ†">Ù…Ø¯Ù†ÙŠÙ†</option>
    </select>
    <select class="filter-select" id="fPrice" onchange="applyFilters()">
      <option value="">Ø£ÙŠ Ø³Ø¹Ø±</option>
      <option value="0-100000">Ø£Ù‚Ù„ Ù…Ù† 100,000 Ø¯.Øª</option>
      <option value="100000-300000">100,000 - 300,000 Ø¯.Øª</option>
      <option value="300000-600000">300,000 - 600,000 Ø¯.Øª</option>
      <option value="600000-999999999">Ø£ÙƒØ«Ø± Ù…Ù† 600,000 Ø¯.Øª</option>
    </select>
    <button class="filter-btn" onclick="clearFilters()">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
    <div class="view-toggle">
      <button class="view-btn active" id="gridViewBtn" onclick="setView('grid')">âŠ</button>
      <button class="view-btn" id="listViewBtn" onclick="setView('list')">â˜°</button>
    </div>
  </div>
  <div class="listings-container">
    <div class="results-count" id="resultsCount"></div>
    <div class="listings-grid" id="listingsGrid"></div>
  </div>
</div>

<!-- MAP PAGE -->
<div id="page-map-view" class="page">
  <div id="map"></div>
</div>

<!-- ADD LISTING PAGE -->
<div id="page-add" class="page">
  <div class="add-listing-page">
    <div class="page-title">â• Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯</div>
    <div class="page-subtitle">Ø£Ø¶Ù Ø¥Ø¹Ù„Ø§Ù†Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ ÙˆØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ† ÙˆØ§Ù„Ù…Ø³ØªØ£Ø¬Ø±ÙŠÙ†</div>

    <div class="form-card">
      <div class="form-card-title">ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©</div>
      <div class="form-group">
        <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</label>
        <input type="text" class="form-input" id="newTitle" placeholder="Ù…Ø«Ø§Ù„: Ø´Ù‚Ø© Ù„Ù„Ø¨ÙŠØ¹ ÙÙŠ Ø­ÙŠ Ø§Ù„Ù†ØµØ± - ØªÙˆÙ†Ø³"/>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø±Ø¶</label>
          <select class="form-input" id="newType">
            <option value="sale">Ù„Ù„Ø¨ÙŠØ¹</option>
            <option value="rent">Ù„Ù„Ø¥ÙŠØ¬Ø§Ø±</option>
          </select>
        </div>
        <div class="form-group">
          <label>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±</label>
          <select class="form-input" id="newCat">
            <option value="apartment">Ø´Ù‚Ø©</option>
            <option value="villa">ÙÙŠÙ„Ø§</option>
            <option value="house">Ù…Ù†Ø²Ù„</option>
            <option value="land">Ø£Ø±Ø¶</option>
            <option value="commercial">ØªØ¬Ø§Ø±ÙŠ</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
          <select class="form-input" id="newCity">
            <option>ØªÙˆÙ†Ø³</option><option>ØµÙØ§Ù‚Ø³</option><option>Ø³ÙˆØ³Ø©</option>
            <option>Ø¨Ù†Ø²Ø±Øª</option><option>Ù†Ø§Ø¨Ù„</option><option>Ø§Ù„Ù…Ù†Ø³ØªÙŠØ±</option>
            <option>Ù‚Ø§Ø¨Ø³</option><option>Ù…Ø¯Ù†ÙŠÙ†</option><option>Ù‚ÙØµØ©</option>
          </select>
        </div>
        <div class="form-group">
          <label>Ø§Ù„Ø­ÙŠ / Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
          <input type="text" class="form-input" id="newArea" placeholder="Ù…Ø«Ø§Ù„: Ø­ÙŠ Ø§Ù„Ù†ØµØ±"/>
        </div>
      </div>
    </div>

    <div class="form-card">
      <div class="form-card-title">ğŸ’° Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„Ù…Ø³Ø§Ø­Ø©</div>
      <div class="form-row">
        <div class="form-group">
          <label>Ø§Ù„Ø³Ø¹Ø± (Ø¯ÙŠÙ†Ø§Ø± ØªÙˆÙ†Ø³ÙŠ)</label>
          <input type="number" class="form-input" id="newPrice" placeholder="250000"/>
        </div>
        <div class="form-group">
          <label>Ø§Ù„Ù…Ø³Ø§Ø­Ø© (Ù…Â²)</label>
          <input type="number" class="form-input" id="newArea2" placeholder="120"/>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Ø¹Ø¯Ø¯ Ø§Ù„ØºØ±Ù</label>
          <input type="number" class="form-input" id="newRooms" placeholder="3" min="0" max="20"/>
        </div>
        <div class="form-group">
          <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ù…Ø§Ù…Ø§Øª</label>
          <input type="number" class="form-input" id="newBaths" placeholder="2" min="0" max="10"/>
        </div>
      </div>
    </div>

    <div class="form-card">
      <div class="form-card-title">ğŸ“ Ø§Ù„ÙˆØµÙ</div>
      <div class="form-group">
        <textarea class="form-input" id="newDesc" placeholder="Ø§ÙƒØªØ¨ ÙˆØµÙØ§Ù‹ ØªÙØµÙŠÙ„ÙŠØ§Ù‹ Ù„Ù„Ø¹Ù‚Ø§Ø±..."></textarea>
      </div>
    </div>

    <div class="form-card">
      <div class="form-card-title">ğŸ“¸ Ø§Ù„ØµÙˆØ±</div>
      <div class="photo-upload" onclick="showToast('Ù…ÙŠØ²Ø© Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± Ø³ØªÙƒÙˆÙ† Ù…ØªØ§Ø­Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹')">
        <div class="icon">ğŸ“·</div>
        <p>Ø§Ù†Ù‚Ø± Ù„Ø¥Ø¶Ø§ÙØ© ØµÙˆØ± Ø§Ù„Ø¹Ù‚Ø§Ø±</p>
      </div>
    </div>

    <div class="form-card">
      <div class="form-card-title">ğŸ“ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„</div>
      <div class="form-row">
        <div class="form-group">
          <label>Ø§Ù„Ø§Ø³Ù…</label>
          <input type="text" class="form-input" id="newName" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„"/>
        </div>
        <div class="form-group">
          <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
          <input type="tel" class="form-input" id="newPhone" placeholder="+216 XX XXX XXX"/>
        </div>
      </div>
    </div>

    <button class="submit-btn" onclick="submitListing()">ğŸš€ Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</button>
  </div>
</div>

<!-- PROFILE PAGE -->
<div id="page-profile" class="page">
  <div class="profile-page">
    <div class="profile-header">
      <div class="profile-avatar" id="profileAvatar">ğŸ‘¤</div>
      <div class="profile-name" id="profileName">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</div>
      <div class="profile-email" id="profileEmail"></div>
    </div>
    <div class="my-listings-title">Ø¥Ø¹Ù„Ø§Ù†Ø§ØªÙŠ</div>
    <div class="listings-grid" id="myListings"></div>
  </div>
</div>

<!-- LISTING DETAIL MODAL -->
<div class="modal-overlay" id="detailModal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('detailModal')">âœ•</button>
    <div class="modal-img" id="modalImg"></div>
    <div class="modal-body">
      <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
        <span id="modalBadge" class="card-badge"></span>
      </div>
      <div class="modal-price" id="modalPrice"></div>
      <div class="modal-title" id="modalTitle"></div>
      <div class="modal-location" id="modalLoc"></div>
      <div class="modal-features" id="modalFeatures"></div>
      <div class="modal-desc" id="modalDesc"></div>
      <div class="modal-contact">
        <button class="btn-call" id="modalCall">ğŸ“ Ø§ØªØµØ§Ù„</button>
        <button class="btn-whatsapp" id="modalWA">ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨</button>
      </div>
    </div>
  </div>
</div>

<!-- AUTH MODAL -->
<div class="modal-overlay" id="authModal">
  <div class="modal" style="max-width:420px;">
    <button class="modal-close" onclick="closeModal('authModal')">âœ•</button>
    <div class="modal-body" style="padding-top:36px;">
      <div class="auth-tabs">
        <div class="auth-tab active" onclick="switchTab('login')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
        <div class="auth-tab" onclick="switchTab('register')">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</div>
      </div>

      <!-- Login -->
      <div id="loginForm">
        <div class="form-group">
          <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
          <input type="email" class="form-input" id="loginEmail" placeholder="example@email.com"/>
        </div>
        <div class="form-group">
          <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
          <input type="password" class="form-input" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"/>
        </div>
        <button class="submit-btn" onclick="doLogin()" style="margin-top:8px;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      </div>

      <!-- Register -->
      <div id="registerForm" style="display:none;">
        <div class="form-group">
          <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
          <input type="text" class="form-input" id="regName" placeholder="Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø¹Ù„ÙŠ"/>
        </div>
        <div class="form-group">
          <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
          <input type="email" class="form-input" id="regEmail" placeholder="example@email.com"/>
        </div>
        <div class="form-group">
          <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
          <input type="tel" class="form-input" id="regPhone" placeholder="+216 XX XXX XXX"/>
        </div>
        <div class="form-group">
          <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
          <input type="password" class="form-input" id="regPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"/>
        </div>
        <button class="submit-btn" onclick="doRegister()" style="margin-top:8px;">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
      </div>
    </div>
  </div>
</div>

<!-- FAB -->
<button class="fab" onclick="showPage('add'); setActive(document.querySelectorAll('.nav-btn')[3])" title="Ø£Ø¶Ù Ø¥Ø¹Ù„Ø§Ù†">+</button>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// ===== JSONBIN CONFIG =====
// BURAYA KENDÄ° BÄ°LGÄ°LERÄ°NÄ° YAPIÅTIRACAKSIN:
const JSONBIN_BIN_ID  = '69a23c24ae596e708f50df2b';
const JSONBIN_API_KEY = '$2a$10$lpE.sTjtWHa1ogDXWSQIgOtR8JOSUsTesQMFasdgZpheBrITBWTGO';

// ===== DATA =====
let listings = [];
let _allListingsFromServer = []; // sunucudan gelen veri

// JSONBin'den ilanlarÄ± yÃ¼kle
async function loadListingsFromJSONBin() {
  try {
    const res = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}/latest`, {
      headers: { 'X-Master-Key': JSONBIN_API_KEY }
    });
    const data = await res.json();
    const serverListings = data.record?.listings || [];
    if (serverListings.length > 0) {
      listings = serverListings;
      filteredListings = [...listings];
      renderFeatured();
      renderListings();
    }
  } catch(e) {
    console.warn('JSONBin yÃ¼klenemedi, Ã¶rnek veriler kullanÄ±lÄ±yor:', e.message);
  }
}

// JSONBin'e ilanlarÄ± kaydet
async function saveListingsToJSONBin() {
  try {
    await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        'X-Master-Key': JSONBIN_API_KEY
      },
      body: JSON.stringify({ listings })
    });
    return true;
  } catch(e) {
    console.error('JSONBin kayÄ±t hatasÄ±:', e);
    return false;
  }
}

// Sayfa yÃ¼klenince Ã§ek
window.addEventListener('load', loadListingsFromJSONBin);

let currentUser = null;
let currentView = 'grid';
let mapInstance = null;
let filteredListings = [...listings];

// ===== PAGES =====
function showPage(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-' + name).classList.add('active');
  if (name === 'map-view') initMap();
  if (name === 'home') renderFeatured();
  if (name === 'listings') renderListings();
  if (name === 'profile') renderProfile();
}

function setActive(el) {
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  if (el) el.classList.add('active');
}

// ===== RENDER =====
function renderFeatured() {
  const grid = document.getElementById('featuredGrid');
  document.getElementById('totalCount').textContent = listings.length;
  grid.innerHTML = listings.slice(0, 6).map(l => cardHTML(l)).join('');
}

function renderListings() {
  const grid = document.getElementById('listingsGrid');
  grid.className = currentView === 'grid' ? 'listings-grid' : 'listings-grid listings-list';
  grid.innerHTML = filteredListings.length ? filteredListings.map(l => cardHTML(l)).join('') :
    `<div class="empty-state" style="grid-column:1/-1"><div class="icon">ğŸ”</div><h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</h3><p>Ø­Ø§ÙˆÙ„ ØªØºÙŠÙŠØ± Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«</p></div>`;
  document.getElementById('resultsCount').textContent = `${filteredListings.length} Ø¥Ø¹Ù„Ø§Ù†`;
}

function cardHTML(l) {
  const isRent = l.type === 'rent';
  const priceStr = isRent ? `${l.price.toLocaleString()} Ø¯.Øª/Ø´Ù‡Ø±` : `${l.price.toLocaleString()} Ø¯.Øª`;
  return `
    <div class="listing-card" onclick="openDetail(${l.id})">
      <div class="card-img" style="font-size:60px">${l.emoji}
        <div class="card-badge ${isRent?'rent':''}">${isRent?'Ù„Ù„Ø¥ÙŠØ¬Ø§Ø±':'Ù„Ù„Ø¨ÙŠØ¹'}</div>
        <button class="card-fav" onclick="toggleFav(event,${l.id})">ğŸ¤</button>
      </div>
      <div class="card-body">
        <div class="card-price">${priceStr}</div>
        <div class="card-title">${l.title}</div>
        <div class="card-location">ğŸ“ ${l.area}ØŒ ${l.city}</div>
        <div class="card-features">
          ${l.rooms ? `<div class="card-feature">ğŸ›ï¸ ${l.rooms} ØºØ±Ù</div>` : ''}
          ${l.baths ? `<div class="card-feature">ğŸš¿ ${l.baths} Ø­Ù…Ø§Ù…</div>` : ''}
          <div class="card-feature">ğŸ“ ${l.size} Ù…Â²</div>
        </div>
      </div>
    </div>`;
}

// ===== DETAIL =====
function openDetail(id) {
  const l = listings.find(x => x.id === id);
  if (!l) return;
  const isRent = l.type === 'rent';
  document.getElementById('modalImg').textContent = l.emoji;
  document.getElementById('modalBadge').textContent = isRent ? 'Ù„Ù„Ø¥ÙŠØ¬Ø§Ø±' : 'Ù„Ù„Ø¨ÙŠØ¹';
  document.getElementById('modalBadge').className = `card-badge ${isRent?'rent':''}`;
  document.getElementById('modalPrice').textContent = isRent ? `${l.price.toLocaleString()} Ø¯.Øª / Ø´Ù‡Ø±` : `${l.price.toLocaleString()} Ø¯.Øª`;
  document.getElementById('modalTitle').textContent = l.title;
  document.getElementById('modalLoc').textContent = `ğŸ“ ${l.area}ØŒ ${l.city}`;
  document.getElementById('modalDesc').textContent = l.desc;
  document.getElementById('modalFeatures').innerHTML = `
    ${l.rooms ? `<div class="modal-feature"><div class="icon">ğŸ›ï¸</div><div class="val">${l.rooms}</div><div class="label">ØºØ±Ù</div></div>` : ''}
    ${l.baths ? `<div class="modal-feature"><div class="icon">ğŸš¿</div><div class="val">${l.baths}</div><div class="label">Ø­Ù…Ø§Ù…Ø§Øª</div></div>` : ''}
    <div class="modal-feature"><div class="icon">ğŸ“</div><div class="val">${l.size}</div><div class="label">Ù…Â²</div></div>
  `;
  document.getElementById('modalCall').onclick = () => showToast('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ' + l.phone);
  document.getElementById('modalWA').onclick = () => showToast('ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨: ' + l.phone);
  document.getElementById('detailModal').classList.add('open');
}

function closeModal(id) {
  document.getElementById(id).classList.remove('open');
}

// ===== FILTERS =====
function applyFilters() {
  const type = document.getElementById('fType').value;
  const cat = document.getElementById('fCat').value;
  const city = document.getElementById('fCity').value;
  const priceRange = document.getElementById('fPrice').value;

  filteredListings = listings.filter(l => {
    if (type && l.type !== type) return false;
    if (cat && l.cat !== cat) return false;
    if (city && l.city !== city) return false;
    if (priceRange) {
      const [min,max] = priceRange.split('-').map(Number);
      if (l.price < min || l.price > max) return false;
    }
    return true;
  });
  renderListings();
}

function clearFilters() {
  ['fType','fCat','fCity','fPrice'].forEach(id => document.getElementById(id).value = '');
  filteredListings = [...listings];
  renderListings();
}

function setView(v) {
  currentView = v;
  document.getElementById('gridViewBtn').classList.toggle('active', v==='grid');
  document.getElementById('listViewBtn').classList.toggle('active', v==='list');
  renderListings();
}

function doHeroSearch() {
  const q = document.getElementById('heroSearch').value.toLowerCase();
  const type = document.getElementById('heroType').value;
  filteredListings = listings.filter(l => {
    const matches = !q || l.title.includes(q) || l.city.includes(q) || l.area.includes(q);
    const typeMatch = !type || l.type === type;
    return matches && typeMatch;
  });
  showPage('listings');
  setActive(document.querySelectorAll('.nav-btn')[1]);
}

// ===== MAP =====
function initMap() {
  if (mapInstance) { mapInstance.invalidateSize(); return; }
  mapInstance = L.map('map').setView([33.9, 9.5], 6);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© OpenStreetMap contributors'
  }).addTo(mapInstance);

  listings.forEach(l => {
    const popup = `<div style="font-family:Cairo,sans-serif;direction:rtl;text-align:right;min-width:180px">
      <b style="font-size:14px">${l.title}</b><br>
      <span style="color:#C4953A;font-weight:700">${l.price.toLocaleString()} Ø¯.Øª</span><br>
      <span style="font-size:12px;color:#666">ğŸ“ ${l.city}</span><br>
      <button onclick="openDetail(${l.id})" style="margin-top:8px;padding:6px 12px;background:#C4953A;border:none;border-radius:6px;font-family:Cairo,sans-serif;cursor:pointer;font-weight:700">Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</button>
    </div>`;

    L.circleMarker([l.lat, l.lng], {
      radius: 12, fillColor: l.type==='rent'?'#2D8A4E':'#C4953A',
      color: 'white', weight: 2, fillOpacity: 0.9
    }).addTo(mapInstance).bindPopup(popup);
  });
}

// ===== AUTH =====
function openAuth() {
  if (currentUser) { showPage('profile'); return; }
  document.getElementById('authModal').classList.add('open');
}

function switchTab(tab) {
  document.querySelectorAll('.auth-tab').forEach((t,i) => t.classList.toggle('active', (i===0&&tab==='login')||(i===1&&tab==='register')));
  document.getElementById('loginForm').style.display = tab==='login' ? 'block' : 'none';
  document.getElementById('registerForm').style.display = tab==='register' ? 'block' : 'none';
}

function doLogin() {
  const email = document.getElementById('loginEmail').value;
  const pass = document.getElementById('loginPassword').value;
  if (!email || !pass) { showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„'); return; }
  currentUser = { name: email.split('@')[0], email };
  closeModal('authModal');
  updateAuthBtn();
  showToast('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ' + currentUser.name + '! ğŸ‘‹');
}

function doRegister() {
  const name = document.getElementById('regName').value;
  const email = document.getElementById('regEmail').value;
  const pass = document.getElementById('regPassword').value;
  if (!name || !email || !pass) { showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„'); return; }
  currentUser = { name, email };
  closeModal('authModal');
  updateAuthBtn();
  showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰');
}

function updateAuthBtn() {
  const btn = document.querySelector('.btn-primary');
  if (currentUser) {
    btn.textContent = currentUser.name;
    btn.onclick = () => { showPage('profile'); };
  }
}

function renderProfile() {
  if (!currentUser) { openAuth(); return; }
  document.getElementById('profileName').textContent = currentUser.name;
  document.getElementById('profileEmail').textContent = currentUser.email;
  document.getElementById('profileAvatar').textContent = currentUser.name[0].toUpperCase();
  const myL = listings.filter(l => l.addedBy === currentUser.email);
  const container = document.getElementById('myListings');
  container.innerHTML = myL.length ? myL.map(l => cardHTML(l)).join('') :
    `<div class="empty-state" style="grid-column:1/-1"><div class="icon">ğŸ </div><h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø¨Ø¹Ø¯</h3><p>Ø£Ø¶Ù Ø£ÙˆÙ„ Ø¥Ø¹Ù„Ø§Ù† Ø¹Ù‚Ø§Ø±ÙŠ Ø§Ù„Ø¢Ù†</p></div>`;
}

// ===== ADD LISTING =====
async function submitListing() {
  const title = document.getElementById('newTitle').value;
  const price = document.getElementById('newPrice').value;
  const city = document.getElementById('newCity').value;
  if (!title || !price) { showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©'); return; }

  const emojis = {'apartment':'ğŸ¢','villa':'ğŸ¡','house':'ğŸ˜ï¸','land':'ğŸŒ¿','commercial':'ğŸª'};
  const cat = document.getElementById('newCat').value;

  const newL = {
    id: Date.now(),
    title,
    type: document.getElementById('newType').value,
    cat,
    city,
    area: document.getElementById('newArea').value || city,
    price: parseInt(price),
    size: parseInt(document.getElementById('newArea2').value) || 100,
    rooms: parseInt(document.getElementById('newRooms').value) || 0,
    baths: parseInt(document.getElementById('newBaths').value) || 0,
    phone: document.getElementById('newPhone').value || '+216 00 000 000',
    desc: document.getElementById('newDesc').value || 'ÙˆØµÙ Ø§Ù„Ø¹Ù‚Ø§Ø±',
    emoji: emojis[cat] || 'ğŸ ',
    lat: 33.9 + (Math.random()-0.5)*4,
    lng: 9.5 + (Math.random()-0.5)*4,
    addedBy: currentUser?.email || 'misafir'
  };

  showToast('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±... â³');
  listings.unshift(newL);
  filteredListings = [...listings];

  const saved = await saveListingsToJSONBin();
  if (saved) {
    showToast('ØªÙ… Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù†Ùƒ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰');
  } else {
    showToast('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø· âš ï¸');
  }

  showPage('listings');
  setActive(document.querySelectorAll('.nav-btn')[1]);
}

// ===== UTILS =====
function toggleFav(e, id) {
  e.stopPropagation();
  e.target.textContent = e.target.textContent === 'ğŸ¤' ? 'â¤ï¸' : 'ğŸ¤';
  showToast(e.target.textContent === 'â¤ï¸' ? 'ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙØ¶Ù„Ø©' : 'ØªÙ…Øª Ø§Ù„Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø©');
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2800);
}

// Close modal on outside click
document.querySelectorAll('.modal-overlay').forEach(o => {
  o.addEventListener('click', e => { if (e.target === o) o.classList.remove('open'); });
});

// INIT
renderFeatured();
</script>
</body>
</html>
