<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒ∞stegelsin | Alƒ±≈üveri≈ü ve ƒ∞lan Platformu</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* ========== TEMEL STƒ∞L ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        /* ========== TOPBAR ========== */
        .topbar {
            background: #2c3e50;
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: 2px;
            cursor: pointer;
            background: linear-gradient(135deg, #fff, #f1c40f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .search-bar {
            flex: 1;
            max-width: 600px;
            margin: 0 30px;
            display: flex;
        }

        .search-bar input {
            width: 100%;
            padding: 12px 20px;
            border: none;
            border-radius: 30px 0 0 30px;
            font-size: 16px;
            outline: none;
        }

        .search-bar button {
            background: #f1c40f;
            color: #2c3e50;
            border: none;
            padding: 12px 25px;
            border-radius: 0 30px 30px 0;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }

        .search-bar button:hover {
            background: #d4ac0d;
        }

        .auth-buttons {
            display: flex;
            gap: 15px;
        }

        .auth-buttons button {
            background: transparent;
            border: 2px solid #f1c40f;
            color: #f1c40f;
            padding: 8px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .auth-buttons button:hover {
            background: #f1c40f;
            color: #2c3e50;
        }

        /* ========== ANA ƒ∞√áERƒ∞K (SOL MEN√ú + SAƒû ƒ∞LANLAR) ========== */
        .main-content {
            display: flex;
            min-height: calc(100vh - 80px);
        }

        /* SOL KATEGORƒ∞ MEN√úS√ú */
        .sidebar {
            width: 280px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
            padding: 20px 0;
            overflow-y: auto;
            height: calc(100vh - 80px);
            position: sticky;
            top: 80px;
        }

        .category-section {
            margin-bottom: 15px;
        }

        .category-main {
            padding: 12px 20px;
            background: #f8f9fa;
            font-weight: 700;
            font-size: 16px;
            color: #2c3e50;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #f1c40f;
            transition: background 0.3s;
        }

        .category-main:hover {
            background: #e9ecef;
        }

        .category-main .arrow {
            font-size: 12px;
            transition: transform 0.3s;
        }

        .category-main.open .arrow {
            transform: rotate(90deg);
        }

        .subcategory-list {
            list-style: none;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background: #fff;
        }

        .subcategory-list.show {
            max-height: 500px; /* Yeterli olacak kadar b√ºy√ºk */
            transition: max-height 0.5s ease-in;
        }

        .subcategory-item {
            padding: 10px 20px 10px 40px;
            font-size: 14px;
            color: #555;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 1px solid #f1f1f1;
        }

        .subcategory-item:hover {
            background: #f1c40f20;
            color: #2c3e50;
            padding-left: 45px;
        }

        .subcategory-item.active {
            background: #f1c40f30;
            color: #2c3e50;
            font-weight: 600;
            border-left: 3px solid #f1c40f;
        }

        /* SAƒû ƒ∞√áERƒ∞K (ƒ∞LANLAR) */
        .content {
            flex: 1;
            padding: 30px;
            background: #f5f5f5;
        }

        .filter-buttons {
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .filter-buttons button {
            background: white;
            border: 1px solid #ddd;
            padding: 10px 25px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .filter-buttons button:hover {
            background: #f1c40f;
            color: #2c3e50;
            border-color: #f1c40f;
        }

        .filter-buttons button.active {
            background: #2c3e50;
            color: white;
            border-color: #2c3e50;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 20px;
        }

        .card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            position: relative;
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }

        .category-tag {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #f1c40f;
            color: #2c3e50;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            z-index: 2;
        }

        .card-image {
            height: 200px;
            overflow: hidden;
        }

        .card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }

        .card:hover .card-image img {
            transform: scale(1.05);
        }

        .card-content {
            padding: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #2c3e50;
        }

        .card-location {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 10px;
        }

        .card-details {
            font-size: 14px;
            color: #34495e;
            margin: 10px 0;
        }

        .card-price {
            font-size: 22px;
            font-weight: 700;
            color: #27ae60;
            border-top: 1px solid #ecf0f1;
            padding-top: 15px;
            margin-top: 15px;
        }

        .card-price span {
            font-size: 14px;
            font-weight: 400;
            color: #7f8c8d;
        }

        .no-listing {
            text-align: center;
            padding: 60px;
            font-size: 18px;
            color: #95a5a6;
            grid-column: 1 / -1;
        }

        .btn-add-listing {
            background: #2c3e50;
            color: white;
            border: none;
            padding: 16px 40px;
            font-size: 18px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
            box-shadow: 0 5px 15px rgba(44,62,80,0.3);
            margin: 30px auto;
            display: inline-block;
        }

        .btn-add-listing:hover {
            background: #f1c40f;
            color: #2c3e50;
        }

        /* ========== MODAL STƒ∞LLERƒ∞ ========== */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 40px;
            max-width: 550px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border-radius: 15px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 30px;
            cursor: pointer;
            color: #95a5a6;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: #2c3e50;
        }

        .modal h2 {
            font-size: 28px;
            margin-bottom: 30px;
            color: #2c3e50;
        }

        .modal-form input,
        .modal-form select,
        .modal-form textarea {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .modal-form button {
            background: #2c3e50;
            color: white;
            border: none;
            padding: 15px;
            width: 100%;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }

        .modal-form button:hover {
            background: #f1c40f;
            color: #2c3e50;
        }

        .modal-footer {
            margin-top: 25px;
            text-align: center;
            color: #7f8c8d;
        }

        .modal-footer a {
            color: #f1c40f;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
        }

        /* ========== FOOTER ========== */
        footer {
            background: #2c3e50;
            color: #bdc3c7;
            text-align: center;
            padding: 25px;
            font-size: 14px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                top: 0;
            }
            .topbar {
                flex-wrap: wrap;
                gap: 15px;
            }
            .search-bar {
                order: 3;
                max-width: 100%;
                margin: 10px 0 0;
            }
        }
    </style>
</head>
<body>

    <!-- TOPBAR -->
    <div class="topbar">
        <div class="logo" onclick="anasayfa()">ƒ∞stegelsin</div>
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Ne aramƒ±≈ütƒ±nƒ±z? (Ba≈ülƒ±k veya a√ßƒ±klama)">
            <button id="searchBtn">ARA</button>
        </div>
        <div class="auth-buttons" id="authButtons"></div>
    </div>

    <!-- ANA ƒ∞√áERƒ∞K (SOL MEN√ú + SAƒû ƒ∞LANLAR) -->
    <div class="main-content">
        <!-- SOL KATEGORƒ∞ MEN√úS√ú -->
        <div class="sidebar" id="sidebar">
            <!-- Kategoriler JavaScript ile dinamik olarak olu≈üturulacak -->
        </div>

        <!-- SAƒû ƒ∞√áERƒ∞K (ƒ∞LANLAR) -->
        <div class="content">
            <div class="filter-buttons">
                <button onclick="filtrele('tumu')" id="filterAll">T√ºm√º</button>
                <button onclick="filtrele('emlak')" id="filterEmlak">Emlak</button>
                <button onclick="filtrele('vasita')" id="filterVasita">Vasƒ±ta</button>
                <button onclick="filtrele('ikinciel')" id="filterIkinciEl">ƒ∞kinci El</button>
                <button onclick="filtrele('sifir')" id="filterSifir">Sƒ±fƒ±r</button>
                <button onclick="filtrele('alisveris')" id="filterAlisveris">Alƒ±≈üveri≈ü</button>
                <button onclick="filtrele('endustri')" id="filterEndustri">End√ºstri</button>
                <button onclick="filtrele('hizmetler')" id="filterHizmetler">Hizmetler</button>
                <button onclick="filtrele('ustalar')" id="filterUstalar">Ustalar</button>
                <button onclick="filtrele('ders')" id="filterDers">√ñzel Ders</button>
                <button onclick="filtrele('is')" id="filterIs">ƒ∞≈ü ƒ∞lanlarƒ±</button>
            </div>

            <div id="listingCount" style="margin-bottom: 20px; font-weight: 600; color: #2c3e50;">0 ilan bulundu.</div>

            <div class="card-grid" id="allListings">
                <!-- ƒ∞lanlar buraya gelecek -->
            </div>

            <!-- ƒ∞LAN EKLE BUTONU (SADECE Gƒ∞Rƒ∞≈û YAPMI≈ûLARA G√ñSTERƒ∞Lƒ∞R) -->
            <div class="add-listing-container" id="addListingContainer" style="display: none; text-align: center;">
                <button class="btn-add-listing" id="addListingBtn">+ YENƒ∞ ƒ∞LAN EKLE</button>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer>
        <p>¬© 2025 ƒ∞stegelsin - T√ºm haklarƒ± saklƒ±dƒ±r.</p>
        <p style="margin-top: 10px; font-size: 12px;">Supabase ile g√º√ßlendirilmi≈ütir.</p>
    </footer>

    <!-- ========== MODALLAR ========== -->
    <!-- √úye Ol Modal -->
    <div id="signupModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeSignup">&times;</span>
            <h2>√úye Ol</h2>
            <form class="modal-form" id="signupForm">
                <input type="text" id="signupName" placeholder="Ad Soyad" required>
                <input type="email" id="signupEmail" placeholder="E-posta" required>
                <input type="password" id="signupPassword" placeholder="≈ûifre" required>
                <button type="submit">KAYIT OL</button>
            </form>
            <div class="modal-footer">Zaten √ºye misiniz? <a id="goToLogin">Giri≈ü Yap</a></div>
        </div>
    </div>

    <!-- Giri≈ü Yap Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeLogin">&times;</span>
            <h2>Giri≈ü Yap</h2>
            <form class="modal-form" id="loginForm">
                <input type="email" id="loginEmail" placeholder="E-posta" required>
                <input type="password" id="loginPassword" placeholder="≈ûifre" required>
                <button type="submit">Gƒ∞Rƒ∞≈û</button>
            </form>
            <div class="modal-footer">Hesabƒ±nƒ±z yok mu? <a id="goToSignup">√úye Ol</a></div>
        </div>
    </div>

    <!-- ƒ∞lan Ekle Modal (Dinamik kategori se√ßimi) -->
    <div id="addListingModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeAddListing">&times;</span>
            <h2>ƒ∞lan Ekle</h2>
            <form class="modal-form" id="addListingForm">
                <!-- Kategori Se√ßimi (ana kategori + alt kategori) -->
                <select id="mainCategory" required onchange="altKategorileriGuncelle()">
                    <option value="">Ana Kategori Se√ßin</option>
                    <option value="emlak">Emlak</option>
                    <option value="vasita">Vasƒ±ta</option>
                    <option value="ikinciel">ƒ∞kinci El</option>
                    <option value="sifir">Sƒ±fƒ±r</option>
                    <option value="alisveris">Alƒ±≈üveri≈ü</option>
                    <option value="endustri">End√ºstri</option>
                    <option value="hizmetler">Hizmetler</option>
                    <option value="ustalar">Ustalar</option>
                    <option value="ders">√ñzel Ders</option>
                    <option value="is">ƒ∞≈ü ƒ∞lanlarƒ±</option>
                </select>

                <select id="subCategory" required style="display: none;">
                    <option value="">Alt Kategori Se√ßin</option>
                </select>

                <input type="text" id="listingTitle" placeholder="ƒ∞lan Ba≈ülƒ±ƒüƒ±" required>
                <input type="text" id="listingLocation" placeholder="Konum (≈üehir, mahalle)" required>
                <input type="number" id="listingPrice" placeholder="Fiyat (‚Ç¨)" required>
                <textarea id="listingDescription" placeholder="ƒ∞lan A√ßƒ±klamasƒ±" rows="3" required></textarea>
                <input type="url" id="listingImage" placeholder="Resim URL'si (isteƒüe baƒülƒ±)">

                <!-- Kategoriye √∂zel alanlar (dinamik) -->
                <div id="ozelAlanlar"></div>

                <button type="submit">ƒ∞LANI YAYINLA</button>
            </form>
        </div>
    </div>

    <!-- ========== SUPABASE BAƒûLANTI VE T√úM FONKSƒ∞YONLAR ========== -->
    <script>
        (function() {
            // ---------- SENƒ∞N SUPABASE Bƒ∞LGƒ∞LERƒ∞N ----------
            const SUPABASE_URL = 'https://sbubvjeguxuqgiklrajk.supabase.co';
            const SUPABASE_ANON_KEY = 'sb_publishable_Ic1qJb5_ljG05NTafWt9ww_2UGX6Xqa';
            // -----------------------------------------------

            const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

            // ========== KATEGORƒ∞ VERƒ∞LERƒ∞ ==========
            const kategoriYapisi = {
                emlak: {
                    ad: 'Emlak',
                    altKategoriler: ['Konut', 'ƒ∞≈ü Yeri', 'Arsa', 'Konut Projeleri', 'Bina', 'Devre M√ºlk', 'Turistik Tesis']
                },
                vasita: {
                    ad: 'Vasƒ±ta',
                    altKategoriler: ['Otomobil', 'Arazi, SUV & Pickup', 'Elektrikli Ara√ßlar', 'Motosiklet', 'Minivan & Panelvan', 'Ticari Ara√ßlar', 'Kiralƒ±k Ara√ßlar', 'Deniz Ara√ßlarƒ±', 'Hasarlƒ± Ara√ßlar']
                },
                ikinciel: {
                    ad: 'ƒ∞kinci El',
                    altKategoriler: ['Elektronik', 'Ev E≈üyasƒ±', 'Giyim', 'Kitap', 'Spor', 'M√ºzik', 'Diƒüer']
                },
                sifir: {
                    ad: 'Sƒ±fƒ±r',
                    altKategoriler: ['Elektronik', 'Ev E≈üyasƒ±', 'Giyim', 'Aksesuar', 'Hobi', 'Diƒüer']
                },
                alisveris: {
                    ad: 'Alƒ±≈üveri≈ü',
                    altKategoriler: ['Gƒ±da', 'Ki≈üisel Bakƒ±m', 'Ev Temizlik', 'Pet Shop', 'Bebek', 'Diƒüer']
                },
                endustri: {
                    ad: 'End√ºstri',
                    altKategoriler: ['ƒ∞n≈üaat', 'Makina', 'Elektrik', 'Hƒ±rdavat', 'G√ºvenlik', 'ƒ∞≈ü Makineleri', 'Diƒüer']
                },
                hizmetler: {
                    ad: 'Hizmetler',
                    altKategoriler: ['Tamir', 'Bakƒ±m', 'Nakliye', 'Temizlik', 'Organizasyon', 'Saƒülƒ±k', 'G√ºzellik', 'Diƒüer']
                },
                ustalar: {
                    ad: 'Ustalar',
                    altKategoriler: ['Elektrik√ßi', 'Tesisat√ßƒ±', 'Marangoz', 'Boyacƒ±', 'Kaynak√ßƒ±', 'Oto Tamir', 'Diƒüer']
                },
                ders: {
                    ad: '√ñzel Ders',
                    altKategoriler: ['Matematik', 'Fizik', 'Kimya', 'Biyoloji', 'ƒ∞ngilizce', 'M√ºzik', 'Resim', 'Diƒüer']
                },
                is: {
                    ad: 'ƒ∞≈ü ƒ∞lanlarƒ±',
                    altKategoriler: ['Satƒ±≈ü', 'Pazarlama', 'M√ºhendislik', 'ƒ∞dari ƒ∞≈üler', 'ƒ∞n≈üaat', 'Hizmet', 'Eƒüitim', 'Saƒülƒ±k', 'Diƒüer']
                }
            };

            // ========== SOL MEN√úY√ú OLU≈ûTUR ==========
            function sidebarOlustur() {
                const sidebar = document.getElementById('sidebar');
                sidebar.innerHTML = '';

                for (const [key, kategori] of Object.entries(kategoriYapisi)) {
                    const section = document.createElement('div');
                    section.className = 'category-section';

                    const mainDiv = document.createElement('div');
                    mainDiv.className = 'category-main';
                    mainDiv.setAttribute('data-kategori', key);
                    mainDiv.innerHTML = `${kategori.ad} <span class="arrow">‚ñ∂</span>`;

                    const subUl = document.createElement('ul');
                    subUl.className = 'subcategory-list';

                    kategori.altKategoriler.forEach(alt => {
                        const li = document.createElement('li');
                        li.className = 'subcategory-item';
                        li.setAttribute('data-alt', alt);
                        li.textContent = alt;
                        li.onclick = (e) => {
                            e.stopPropagation();
                            // Aktif sƒ±nƒ±fƒ±nƒ± kaldƒ±r
                            document.querySelectorAll('.subcategory-item').forEach(el => el.classList.remove('active'));
                            li.classList.add('active');
                            // Alt kategoriye g√∂re filtrele
                            filtreleAlt(key, alt);
                        };
                        subUl.appendChild(li);
                    });

                    mainDiv.onclick = () => {
                        mainDiv.classList.toggle('open');
                        subUl.classList.toggle('show');
                    };

                    section.appendChild(mainDiv);
                    section.appendChild(subUl);
                    sidebar.appendChild(section);
                }
            }
            sidebarOlustur();

            // ========== ANA SAYFA FONKSƒ∞YONU ==========
            window.anasayfa = function() {
                // T√ºm aktif sƒ±nƒ±flarƒ±nƒ± kaldƒ±r
                document.querySelectorAll('.subcategory-item').forEach(el => el.classList.remove('active'));
                // T√ºm ilanlarƒ± getir
                loadListings();
            };

            // ========== ALT KATEGORƒ∞ Fƒ∞LTRELE ==========
            async function filtreleAlt(anaKategori, altKategori) {
                const { data: ilanlar, error } = await supabase
                    .from('ilanlar')
                    .select('*')
                    .eq('kategori', `${anaKategori}_${altKategori}`)
                    .order('created_at', { ascending: false });

                if (error) {
                    console.error('ƒ∞lanlar y√ºklenemedi:', error);
                    return;
                }

                // ƒ∞lanlarƒ± g√∂ster
                ilanlariGoster(ilanlar);
                document.getElementById('listingCount').textContent = `${ilanlar.length} ilan bulundu.`;
            }

            // ========== Fƒ∞LTRELEME (ANA KATEGORƒ∞) ==========
            window.filtrele = function(anaKategori) {
                if (anaKategori === 'tumu') {
                    loadListings();
                } else {
                    filtreleAna(anaKategori);
                }
            };

            async function filtreleAna(anaKategori) {
                const { data: ilanlar, error } = await supabase
                    .from('ilanlar')
                    .select('*')
                    .ilike('kategori', `${anaKategori}%`)
                    .order('created_at', { ascending: false });

                if (error) {
                    console.error('ƒ∞lanlar y√ºklenemedi:', error);
                    return;
                }

                ilanlariGoster(ilanlar);
                document.getElementById('listingCount').textContent = `${ilanlar.length} ilan bulundu.`;
            }

            // ========== ƒ∞LANLARI G√ñSTER ==========
            function ilanlariGoster(ilanlar) {
                const allGrid = document.getElementById('allListings');

                if (ilanlar.length === 0) {
                    allGrid.innerHTML = '<div class="no-listing">Bu kategoride hen√ºz ilan bulunmuyor.</div>';
                    return;
                }

                function renderCard(item) {
                    // Kategori adƒ±nƒ± g√ºzel g√∂ster
                    let kategoriAdi = item.kategori;
                    if (item.kategori.includes('_')) {
                        const [ana, alt] = item.kategori.split('_');
                        kategoriAdi = `${kategoriYapisi[ana]?.ad || ana} / ${alt}`;
                    }

                    // √ñzellikleri g√∂ster (ozellikler JSON'dan)
                    let ozellikHtml = '';
                    if (item.ozellikler) {
                        if (item.kategori.startsWith('emlak')) {
                            ozellikHtml = `<p>${item.ozellikler.alan || '?'} m¬≤, ${item.ozellikler.oda || '?'} oda</p>`;
                        } else if (item.kategori.startsWith('vasita')) {
                            ozellikHtml = `<p>${item.ozellikler.marka || ''} ${item.ozellikler.model || ''} ${item.ozellikler.yil || ''} - ${item.ozellikler.km || '?'} km, ${item.ozellikler.yakit || ''}</p>`;
                        } else if (item.kategori.startsWith('ikinciel') || item.kategori.startsWith('sifir')) {
                            ozellikHtml = `<p>${item.ozellikler.durum || ''} ${item.ozellikler.marka || ''}</p>`;
                        }
                        // Diƒüer kategoriler i√ßin benzer eklemeler yapƒ±labilir
                    }

                    return `
                        <div class="card">
                            <div class="category-tag">${kategoriAdi}</div>
                            <div class="card-image">
                                <img src="${item.resim_url || 'https://via.placeholder.com/400x200?text=G√∂rsel+Yok'}" alt="${item.baslik}">
                            </div>
                            <div class="card-content">
                                <div class="card-title">${item.baslik}</div>
                                <div class="card-location">üìç ${item.konum || 'Konum belirtilmemi≈ü'}</div>
                                ${ozellikHtml}
                                <div class="card-price">${item.fiyat} <span>EUR</span></div>
                            </div>
                        </div>
                    `;
                }

                allGrid.innerHTML = ilanlar.map(renderCard).join('');
            }

            // ========== T√úM ƒ∞LANLARI GETƒ∞R ==========
            async function loadListings() {
                const { data: ilanlar, error } = await supabase
                    .from('ilanlar')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) {
                    console.error('ƒ∞lanlar y√ºklenemedi:', error);
                    return;
                }

                ilanlariGoster(ilanlar);
                document.getElementById('listingCount').textContent = `${ilanlar.length} ilan bulundu.`;
            }

            // ========== ARAMA FONKSƒ∞YONU ==========
            document.getElementById('searchBtn').addEventListener('click', async () => {
                const searchTerm = document.getElementById('searchInput').value.trim();
                if (!searchTerm) {
                    loadListings();
                    return;
                }

                const { data: ilanlar, error } = await supabase
                    .from('ilanlar')
                    .select('*')
                    .or(`baslik.ilike.%${searchTerm}%,aciklama.ilike.%${searchTerm}%`)
                    .order('created_at', { ascending: false });

                if (error) {
                    console.error('Arama hatasƒ±:', error);
                    return;
                }

                ilanlariGoster(ilanlar);
                document.getElementById('listingCount').textContent = `${ilanlar.length} ilan bulundu.`;
            });

            // ========== MODAL ƒ∞≈ûLEMLERƒ∞ ==========
            const signupModal = document.getElementById('signupModal');
            const loginModal = document.getElementById('loginModal');
            const addListingModal = document.getElementById('addListingModal');
            const addListingContainer = document.getElementById('addListingContainer');
            const closeSignup = document.getElementById('closeSignup');
            const closeLogin = document.getElementById('closeLogin');
            const closeAddListing = document.getElementById('closeAddListing');
            const goToLogin = document.getElementById('goToLogin');
            const goToSignup = document.getElementById('goToSignup');
            const addListingBtn = document.getElementById('addListingBtn');

            const openModal = (modal) => modal.style.display = 'flex';
            const closeModal = (modal) => modal.style.display = 'none';

            window.addEventListener('click', (e) => {
                if (e.target === signupModal) closeModal(signupModal);
                if (e.target === loginModal) closeModal(loginModal);
                if (e.target === addListingModal) closeModal(addListingModal);
            });

            closeSignup.addEventListener('click', () => closeModal(signupModal));
            closeLogin.addEventListener('click', () => closeModal(loginModal));
            closeAddListing.addEventListener('click', () => closeModal(addListingModal));

            goToLogin.addEventListener('click', (e) => {
                e.preventDefault();
                closeModal(signupModal);
                openModal(loginModal);
            });

            goToSignup.addEventListener('click', (e) => {
                e.preventDefault();
                closeModal(loginModal);
                openModal(signupModal);
            });

            // ========== AUTH DURUMU ==========
            supabase.auth.onAuthStateChange((event, session) => {
                const user = session?.user;
                const authButtonsDiv = document.getElementById('authButtons');

                if (user) {
                    authButtonsDiv.innerHTML = `
                        <span style="color:white; margin-right:10px;">Merhaba, ${user.email}</span>
                        <button id="logoutBtn">√áIKI≈û</button>
                    `;
                    document.getElementById('logoutBtn').addEventListener('click', () => supabase.auth.signOut());
                    addListingContainer.style.display = 'block';
                } else {
                    authButtonsDiv.innerHTML = `
                        <button id="loginBtn">Gƒ∞Rƒ∞≈û</button>
                        <button id="signupBtn">√úYE OL</button>
                    `;
                    document.getElementById('loginBtn').addEventListener('click', () => openModal(loginModal));
                    document.getElementById('signupBtn').addEventListener('click', () => openModal(signupModal));
                    addListingContainer.style.display = 'none';
                }
            });

            // ========== √úYE OL ==========
            document.getElementById('signupForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('signupEmail').value;
                const password = document.getElementById('signupPassword').value;
                const name = document.getElementById('signupName').value;

                const { error } = await supabase.auth.signUp({
                    email,
                    password,
                    options: { data: { full_name: name } }
                });

                if (error) alert('Hata: ' + error.message);
                else {
                    alert('Kayƒ±t ba≈üarƒ±lƒ±! E-postanƒ±zƒ± onaylayƒ±n.');
                    closeModal(signupModal);
                }
            });

            // ========== Gƒ∞Rƒ∞≈û YAP ==========
            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;

                const { error } = await supabase.auth.signInWithPassword({ email, password });
                if (error) alert('Hata: ' + error.message);
                else {
                    alert('Giri≈ü ba≈üarƒ±lƒ±!');
                    closeModal(loginModal);
                }
            });

            // ========== ƒ∞LAN EKLEME ==========
            addListingBtn.addEventListener('click', () => {
                // Alt kategori se√ßimini sƒ±fƒ±rla
                document.getElementById('mainCategory').value = '';
                document.getElementById('subCategory').style.display = 'none';
                document.getElementById('subCategory').innerHTML = '<option value="">Alt Kategori Se√ßin</option>';
                document.getElementById('ozelAlanlar').innerHTML = '';
                openModal(addListingModal);
            });

            // Ana kategori deƒüi≈üince alt kategorileri getir
            window.altKategorileriGuncelle = function() {
                const anaKategori = document.getElementById('mainCategory').value;
                const subSelect = document.getElementById('subCategory');
                const ozelAlanlar = document.getElementById('ozelAlanlar');

                if (!anaKategori) {
                    subSelect.style.display = 'none';
                    ozelAlanlar.innerHTML = '';
                    return;
                }

                const altKategoriler = kategoriYapisi[anaKategori]?.altKategoriler || [];
                subSelect.innerHTML = '<option value="">Alt Kategori Se√ßin</option>';
                altKategoriler.forEach(alt => {
                    const option = document.createElement('option');
                    option.value = alt;
                    option.textContent = alt;
                    subSelect.appendChild(option);
                });
                subSelect.style.display = 'block';
                ozelAlanlar.innerHTML = ''; // √ñzel alanlarƒ± temizle

                // Kategoriye g√∂re √∂zel alanlarƒ± ekle
                if (anaKategori === 'emlak') {
                    ozelAlanlar.innerHTML = `
                        <input type="number" id="emlakAlan" placeholder="Alan (m¬≤)">
                        <input type="text" id="emlakOda" placeholder="Oda Sayƒ±sƒ± (√∂rn: 3+1)">
                    `;
                } else if (anaKategori === 'vasita') {
                    ozelAlanlar.innerHTML = `
                        <input type="text" id="arabaMarka" placeholder="Marka">
                        <input type="text" id="arabaModel" placeholder="Model">
                        <input type="number" id="arabaYil" placeholder="Yƒ±l">
                        <input type="number" id="arabaKm" placeholder="Kilometre">
                        <input type="text" id="arabaYakit" placeholder="Yakƒ±t T√ºr√º">
                    `;
                } else if (anaKategori === 'ikinciel' || anaKategori === 'sifir') {
                    ozelAlanlar.innerHTML = `
                        <input type="text" id="urunMarka" placeholder="Marka">
                        <select id="urunDurum">
                            <option value="">Durum Se√ßin</option>
                            <option value="Sƒ±fƒ±r">Sƒ±fƒ±r</option>
                            <option value="ƒ∞kinci El">ƒ∞kinci El</option>
                        </select>
                    `;
                }
                // Diƒüer kategoriler i√ßin benzer eklemeler yapƒ±labilir
            };

            document.getElementById('addListingForm').addEventListener('submit', async (e) => {
                e.preventDefault();

                const { data: { user } } = await supabase.auth.getUser();
                if (!user) {
                    alert('√ñnce giri≈ü yapmalƒ±sƒ±nƒ±z!');
                    closeModal(addListingModal);
                    return;
                }

                const anaKategori = document.getElementById('mainCategory').value;
                const altKategori = document.getElementById('subCategory').value;

                if (!anaKategori || !altKategori) {
                    alert('L√ºtfen kategori se√ßimini tamamlayƒ±n!');
                    return;
                }

                const kategori = `${anaKategori}_${altKategori}`;
                const title = document.getElementById('listingTitle').value;
                const location = document.getElementById('listingLocation').value;
                const price = document.getElementById('listingPrice').value;
                const description = document.getElementById('listingDescription').value;
                const imageUrl = document.getElementById('listingImage').value || 'https://via.placeholder.com/400x250';

                // √ñzel alanlarƒ± topla
                let ozellikler = {};
                if (anaKategori === 'emlak') {
                    ozellikler = {
                        alan: document.getElementById('emlakAlan')?.value || '',
                        oda: document.getElementById('emlakOda')?.value || ''
                    };
                } else if (anaKategori === 'vasita') {
                    ozellikler = {
                        marka: document.getElementById('arabaMarka')?.value || '',
                        model: document.getElementById('arabaModel')?.value || '',
                        yil: document.getElementById('arabaYil')?.value || '',
                        km: document.getElementById('arabaKm')?.value || '',
                        yakit: document.getElementById('arabaYakit')?.value || ''
                    };
                } else if (anaKategori === 'ikinciel' || anaKategori === 'sifir') {
                    ozellikler = {
                        marka: document.getElementById('urunMarka')?.value || '',
                        durum: document.getElementById('urunDurum')?.value || ''
                    };
                }

                const { error } = await supabase.from('ilanlar').insert([
                    {
                        baslik: title,
                        kategori: kategori,
                        fiyat: price + ' ‚Ç¨',
                        aciklama: description,
                        resim_url: imageUrl,
                        konum: location,
                        ozellikler: ozellikler,
                        user_id: user.id
                    }
                ]);

                if (error) alert('Hata: ' + error.message);
                else {
                    alert('ƒ∞lan ba≈üarƒ±yla eklendi!');
                    closeModal(addListingModal);
                    document.getElementById('addListingForm').reset();
                    document.getElementById('subCategory').style.display = 'none';
                    document.getElementById('ozelAlanlar').innerHTML = '';
                    loadListings();
                }
            });

            // ========== SAYFA Y√úKLENƒ∞NCE ==========
            loadListings();

            // ƒ∞leti≈üim butonu (varsa) - silinebilir, ama uyumluluk i√ßin
            if (document.getElementById('contactBtn')) {
                document.getElementById('contactBtn').addEventListener('click', () => {
                    alert('Mesajƒ±nƒ±z iletilmi≈ütir (sim√ºlasyon).');
                });
            }
        })();
    </script>
</body>
</html>
